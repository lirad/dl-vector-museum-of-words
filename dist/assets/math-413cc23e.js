var Xe=Object.defineProperty;var mt=Math.pow,Ae=(o,r,e)=>r in o?Xe(o,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[r]=e;var oe=(o,r,e)=>(Ae(o,typeof r!="symbol"?r+"":r,e),e),Ut=(o,r,e)=>{if(!r.has(o))throw TypeError("Cannot "+e)};var ot=(o,r,e)=>(Ut(o,r,"read from private field"),e?e.call(o):r.get(o)),Bt=(o,r,e)=>{if(r.has(o))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(o):r.set(o,e)},_t=(o,r,e,t)=>(Ut(o,r,"write to private field"),t?t.call(o,e):r.set(o,e),e);var Wt=(o,r,e)=>(Ut(o,r,"access private method"),e);import{c as I,g as te}from"./vendor-2d4d72d8.js";var He={},Z={},K={},$={},tr=I&&I.__values||function(o){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&o[r],t=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&t>=o.length&&(o=void 0),{value:o&&o[t++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty($,"__esModule",{value:!0});$.reshape2d=$.rejectionSample=$.max2d=$.max=$.mean=$.sum=$.linear=$.ones=$.zeros=$.filled=$.range=$.empty=$.norm=$.tauRand=$.tauRandInt=void 0;function ye(o,r){return Math.floor(r()*o)}$.tauRandInt=ye;function er(o){return o()}$.tauRand=er;function rr(o){var r,e,t=0;try{for(var n=tr(o),s=n.next();!s.done;s=n.next()){var i=s.value;t+=Math.pow(i,2)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(r)throw r.error}}return Math.sqrt(t)}$.norm=rr;function Dt(o){for(var r=[],e=0;e<o;e++)r.push(void 0);return r}$.empty=Dt;function nr(o){return Dt(o).map(function(r,e){return e})}$.range=nr;function ee(o,r){return Dt(o).map(function(){return r})}$.filled=ee;function Se(o){return ee(o,0)}$.zeros=Se;function sr(o){return ee(o,1)}$.ones=sr;function or(o,r,e){return Dt(e).map(function(t,n){return o+n*((r-o)/(e-1))})}$.linear=or;function be(o){return o.reduce(function(r,e){return r+e})}$.sum=be;function ir(o){return be(o)/o.length}$.mean=ir;function lr(o){for(var r=0,e=0;e<o.length;e++)r=o[e]>r?o[e]:r;return r}$.max=lr;function hr(o){for(var r=0,e=0;e<o.length;e++)for(var t=0;t<o[e].length;t++)r=o[e][t]>r?o[e][t]:r;return r}$.max2d=hr;function ur(o,r,e){for(var t=Se(o),n=0;n<o;n++)for(var s=!0;s;){for(var i=ye(r,e),l=!1,u=0;u<n;u++)if(i===t[u]){l=!0;break}l||(s=!1),t[n]=i}return t}$.rejectionSample=ur;function ar(o,r,e){var t=[],n=0;if(o.length!==r*e)throw new Error("Array dimensions must match input length.");for(var s=0;s<r;s++){for(var i=[],l=0;l<e;l++)i.push(o[n]),n+=1;t.push(i)}return t}$.reshape2d=ar;var fr=I&&I.__createBinding||(Object.create?function(o,r,e,t){t===void 0&&(t=e),Object.defineProperty(o,t,{enumerable:!0,get:function(){return r[e]}})}:function(o,r,e,t){t===void 0&&(t=e),o[t]=r[e]}),cr=I&&I.__setModuleDefault||(Object.create?function(o,r){Object.defineProperty(o,"default",{enumerable:!0,value:r})}:function(o,r){o.default=r}),gr=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)e!=="default"&&Object.hasOwnProperty.call(o,e)&&fr(r,o,e);return cr(r,o),r};Object.defineProperty(K,"__esModule",{value:!0});K.smallestFlagged=K.deheapSort=K.buildCandidates=K.uncheckedHeapPush=K.heapPush=K.rejectionSample=K.makeHeap=void 0;var Mt=gr($);function Me(o,r){var e=function(n){return Mt.empty(o).map(function(){return Mt.filled(r,n)})},t=[];return t.push(e(-1)),t.push(e(1/0)),t.push(e(0)),t}K.makeHeap=Me;function mr(o,r,e){for(var t=Mt.zeros(o),n=0;n<o;n++){for(var s=!0,i=0;s;){i=Mt.tauRandInt(r,e);for(var l=!1,u=0;u<n;u++)if(i===t[u]){l=!0;break}l||(s=!1)}t[n]=i}return t}K.rejectionSample=mr;function Gt(o,r,e,t,n){r=Math.floor(r);var s=o[0][r],i=o[1][r];if(o[2][r],e>=i[0])return 0;for(var l=0;l<s.length;l++)if(t===s[l])return 0;return Ee(o,r,e,t,n)}K.heapPush=Gt;function Ee(o,r,e,t,n){var s=o[0][r],i=o[1][r],l=o[2][r];if(e>=i[0])return 0;i[0]=e,s[0]=t,l[0]=n;for(var u=0,h=0;;){var f=2*u+1,a=f+1,g=o[0][0].length;if(f>=g)break;if(a>=g)if(i[f]>e)h=f;else break;else if(i[f]>=i[a])if(e<i[f])h=f;else break;else if(e<i[a])h=a;else break;i[u]=i[h],s[u]=s[h],l[u]=l[h],u=h}return i[u]=e,s[u]=t,l[u]=n,1}K.uncheckedHeapPush=Ee;function pr(o,r,e,t,n){for(var s=Me(r,t),i=0;i<r;i++)for(var l=0;l<e;l++)if(!(o[0][i][l]<0)){var u=o[0][i][l],h=o[2][i][l],f=Mt.tauRand(n);Gt(s,i,f,u,h),Gt(s,u,f,i,h),o[2][i][l]=0}return s}K.buildCandidates=pr;function wr(o){for(var r=o[0],e=o[1],t=0;t<r.length;t++)for(var n=r[t],s=e[t],i=0;i<n.length-1;i++){var l=n.length-i-1,u=s.length-i-1,h=n[0];n[0]=n[l],n[l]=h;var f=s[0];s[0]=s[u],s[u]=f,vr(s,n,u,0)}return{indices:r,weights:e}}K.deheapSort=wr;function vr(o,r,e,t){for(;t*2+1<e;){var n=t*2+1,s=n+1,i=t;if(o[i]<o[n]&&(i=n),s<e&&o[i]<o[s]&&(i=s),i===t)break;var l=o[t];o[t]=o[i],o[i]=l;var u=r[t];r[t]=r[i],r[i]=u,t=i}}function dr(o,r){for(var e=o[0][r],t=o[1][r],n=o[2][r],s=1/0,i=-1,l=0;l>e.length;l++)n[l]===1&&t[l]<s&&(s=t[l],i=l);return i>=0?(n[i]=0,Math.floor(e[i])):-1}K.smallestFlagged=dr;var q={},yr=I&&I.__createBinding||(Object.create?function(o,r,e,t){t===void 0&&(t=e),Object.defineProperty(o,t,{enumerable:!0,get:function(){return r[e]}})}:function(o,r,e,t){t===void 0&&(t=e),o[t]=r[e]}),Sr=I&&I.__setModuleDefault||(Object.create?function(o,r){Object.defineProperty(o,"default",{enumerable:!0,value:r})}:function(o,r){o.default=r}),br=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)e!=="default"&&Object.hasOwnProperty.call(o,e)&&yr(r,o,e);return Sr(r,o),r},Tt=I&&I.__read||function(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var t=e.call(o),n,s=[],i;try{for(;(r===void 0||r-- >0)&&!(n=t.next()).done;)s.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(i)throw i.error}}return s},Mr=I&&I.__values||function(o){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&o[r],t=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&t>=o.length&&(o=void 0),{value:o&&o[t++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},bt;Object.defineProperty(q,"__esModule",{value:!0});q.getCSR=q.normalize=q.eliminateZeros=q.multiplyScalar=q.maximum=q.subtract=q.add=q.pairwiseMultiply=q.identity=q.transpose=q.SparseMatrix=void 0;var ie=br($),yt=function(){function o(r,e,t,n){if(this.entries=new Map,this.nRows=0,this.nCols=0,r.length!==e.length||r.length!==t.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=n[0],this.nCols=n[1];for(var s=0;s<t.length;s++){var i=r[s],l=e[s];this.checkDims(i,l);var u=this.makeKey(i,l);this.entries.set(u,{value:t[s],row:i,col:l})}}return o.prototype.makeKey=function(r,e){return r+":"+e},o.prototype.checkDims=function(r,e){var t=r<this.nRows&&e<this.nCols;if(!t)throw new Error("row and/or col specified outside of matrix dimensions")},o.prototype.set=function(r,e,t){this.checkDims(r,e);var n=this.makeKey(r,e);this.entries.has(n)?this.entries.get(n).value=t:this.entries.set(n,{value:t,row:r,col:e})},o.prototype.get=function(r,e,t){t===void 0&&(t=0),this.checkDims(r,e);var n=this.makeKey(r,e);return this.entries.has(n)?this.entries.get(n).value:t},o.prototype.getAll=function(r){r===void 0&&(r=!0);var e=[];return this.entries.forEach(function(t){e.push(t)}),r&&e.sort(function(t,n){return t.row===n.row?t.col-n.col:t.row-n.row}),e},o.prototype.getDims=function(){return[this.nRows,this.nCols]},o.prototype.getRows=function(){return Array.from(this.entries,function(r){var e=Tt(r,2);e[0];var t=e[1];return t.row})},o.prototype.getCols=function(){return Array.from(this.entries,function(r){var e=Tt(r,2);e[0];var t=e[1];return t.col})},o.prototype.getValues=function(){return Array.from(this.entries,function(r){var e=Tt(r,2);e[0];var t=e[1];return t.value})},o.prototype.forEach=function(r){this.entries.forEach(function(e){return r(e.value,e.row,e.col)})},o.prototype.map=function(r){var e=[];this.entries.forEach(function(n){e.push(r(n.value,n.row,n.col))});var t=[this.nRows,this.nCols];return new o(this.getRows(),this.getCols(),e,t)},o.prototype.toArray=function(){var r=this,e=ie.empty(this.nRows),t=e.map(function(){return ie.zeros(r.nCols)});return this.entries.forEach(function(n){t[n.row][n.col]=n.value}),t},o}();q.SparseMatrix=yt;function Er(o){var r=[],e=[],t=[];o.forEach(function(s,i,l){r.push(i),e.push(l),t.push(s)});var n=[o.nCols,o.nRows];return new yt(e,r,t,n)}q.transpose=Er;function jr(o){for(var r=Tt(o,1),e=r[0],t=new yt([],[],[],o),n=0;n<e;n++)t.set(n,n,1);return t}q.identity=jr;function Rr(o,r){return Vt(o,r,function(e,t){return e*t})}q.pairwiseMultiply=Rr;function _r(o,r){return Vt(o,r,function(e,t){return e+t})}q.add=_r;function Nr(o,r){return Vt(o,r,function(e,t){return e-t})}q.subtract=Nr;function kr(o,r){return Vt(o,r,function(e,t){return e>t?e:t})}q.maximum=kr;function Ir(o,r){return o.map(function(e){return e*r})}q.multiplyScalar=Ir;function zr(o){for(var r=new Set,e=o.getValues(),t=o.getRows(),n=o.getCols(),s=0;s<e.length;s++)e[s]===0&&r.add(s);var i=function(f,a){return!r.has(a)},l=e.filter(i),u=t.filter(i),h=n.filter(i);return new yt(u,h,l,o.getDims())}q.eliminateZeros=zr;function Pr(o,r){var e,t;r===void 0&&(r="l2");var n=Tr[r],s=new Map;o.forEach(function(a,g,v){var m=s.get(g)||[];m.push(v),s.set(g,m)});var i=new yt([],[],[],o.getDims()),l=function(a){for(var g=s.get(a).sort(),v=g.map(function(y){return o.get(a,y)}),m=n(v),w=0;w<m.length;w++)i.set(a,g[w],m[w])};try{for(var u=Mr(s.keys()),h=u.next();!h.done;h=u.next()){var f=h.value;l(f)}}catch(a){e={error:a}}finally{try{h&&!h.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}return i}q.normalize=Pr;var Tr=(bt={},bt.max=function(o){for(var r=-1/0,e=0;e<o.length;e++)r=o[e]>r?o[e]:r;return o.map(function(t){return t/r})},bt.l1=function(o){for(var r=0,e=0;e<o.length;e++)r+=o[e];return o.map(function(t){return t/r})},bt.l2=function(o){for(var r=0,e=0;e<o.length;e++)r+=Math.pow(o[e],2);return o.map(function(t){return Math.sqrt(Math.pow(t,2)/r)})},bt);function Vt(o,r,e){for(var t=new Set,n=[],s=[],i=[],l=function(M,_){n.push(M),s.push(_);var R=e(o.get(M,_),r.get(M,_));i.push(R)},u=o.getValues(),h=o.getRows(),f=o.getCols(),a=0;a<u.length;a++){var g=h[a],v=f[a],m=g+":"+v;t.add(m),l(g,v)}for(var w=r.getValues(),y=r.getRows(),c=r.getCols(),a=0;a<w.length;a++){var g=y[a],v=c[a],m=g+":"+v;t.has(m)||l(g,v)}var d=[o.nRows,o.nCols];return new yt(n,s,i,d)}function Fr(o){var r=[];o.forEach(function(a,g,v){r.push({value:a,row:g,col:v})}),r.sort(function(a,g){return a.row===g.row?a.col-g.col:a.row-g.row});for(var e=[],t=[],n=[],s=-1,i=0;i<r.length;i++){var l=r[i],u=l.row,h=l.col,f=l.value;u!==s&&(s=u,n.push(i)),e.push(h),t.push(f)}return{indices:e,values:t,indptr:n}}q.getCSR=Fr;var ut={},lt={},Or=I&&I.__createBinding||(Object.create?function(o,r,e,t){t===void 0&&(t=e),Object.defineProperty(o,t,{enumerable:!0,get:function(){return r[e]}})}:function(o,r,e,t){t===void 0&&(t=e),o[t]=r[e]}),$r=I&&I.__setModuleDefault||(Object.create?function(o,r){Object.defineProperty(o,"default",{enumerable:!0,value:r})}:function(o,r){o.default=r}),Dr=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)e!=="default"&&Object.hasOwnProperty.call(o,e)&&Or(r,o,e);return $r(r,o),r},Vr=I&&I.__read||function(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var t=e.call(o),n,s=[],i;try{for(;(r===void 0||r-- >0)&&!(n=t.next()).done;)s.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(i)throw i.error}}return s},je=I&&I.__spread||function(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(Vr(arguments[r]));return o},Cr=I&&I.__values||function(o){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&o[r],t=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&t>=o.length&&(o=void 0),{value:o&&o[t++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(lt,"__esModule",{value:!0});lt.searchFlatTree=lt.makeLeafArray=lt.makeForest=lt.FlatTree=void 0;var X=Dr($),Re=function(){function o(r,e,t,n){this.hyperplanes=r,this.offsets=e,this.children=t,this.indices=n}return o}();lt.FlatTree=Re;function Lr(o,r,e,t){var n=Math.max(10,r),s=X.range(e).map(function(l,u){return qr(o,n,u,t)}),i=s.map(function(l){return Ur(l,n)});return i}lt.makeForest=Lr;function qr(o,r,e,t){r===void 0&&(r=30);var n=X.range(o.length),s=Kt(o,n,r,e,t);return s}function Kt(o,r,e,t,n){if(e===void 0&&(e=30),r.length>e){var s=xr(o,r,n),i=s.indicesLeft,l=s.indicesRight,u=s.hyperplane,h=s.offset,f=Kt(o,i,e,t+1,n),a=Kt(o,l,e,t+1,n),g={leftChild:f,rightChild:a,isLeaf:!1,hyperplane:u,offset:h};return g}else{var g={indices:r,isLeaf:!0};return g}}function xr(o,r,e){var t=o[0].length,n=X.tauRandInt(r.length,e),s=X.tauRandInt(r.length,e);s+=n===s?1:0,s=s%r.length;for(var i=r[n],l=r[s],u=0,h=X.zeros(t),f=0;f<h.length;f++)h[f]=o[i][f]-o[l][f],u-=h[f]*(o[i][f]+o[l][f])/2;for(var a=0,g=0,v=X.zeros(r.length),f=0;f<r.length;f++){for(var m=u,w=0;w<t;w++)m+=h[w]*o[r[f]][w];m===0?(v[f]=X.tauRandInt(2,e),v[f]===0?a+=1:g+=1):m>0?(v[f]=0,a+=1):(v[f]=1,g+=1)}var y=X.zeros(a),c=X.zeros(g);a=0,g=0;for(var f=0;f<v.length;f++)v[f]===0?(y[a]=r[f],a+=1):(c[g]=r[f],g+=1);return{indicesLeft:y,indicesRight:c,hyperplane:h,offset:u}}function Ur(o,r){var e=Jt(o),t=Zt(o),n=X.range(e).map(function(){return X.zeros(o.hyperplane?o.hyperplane.length:0)}),s=X.zeros(e),i=X.range(e).map(function(){return[-1,-1]}),l=X.range(t).map(function(){return X.range(r).map(function(){return-1})});return Qt(o,n,s,i,l,0,0),new Re(n,s,i,l)}function Qt(o,r,e,t,n,s,i){var l;if(o.isLeaf)return t[s][0]=-i,(l=n[i]).splice.apply(l,je([0,o.indices.length],o.indices)),i+=1,{nodeNum:s,leafNum:i};r[s]=o.hyperplane,e[s]=o.offset,t[s][0]=s+1;var u=s,h=Qt(o.leftChild,r,e,t,n,s+1,i);return s=h.nodeNum,i=h.leafNum,t[u][1]=s+1,h=Qt(o.rightChild,r,e,t,n,s+1,i),{nodeNum:h.nodeNum,leafNum:h.leafNum}}function Jt(o){return o.isLeaf?1:1+Jt(o.leftChild)+Jt(o.rightChild)}function Zt(o){return o.isLeaf?1:Zt(o.leftChild)+Zt(o.rightChild)}function Br(o){var r,e;if(o.length>0){var t=[];try{for(var n=Cr(o),s=n.next();!s.done;s=n.next()){var i=s.value;t.push.apply(t,je(i.indices))}}catch(l){r={error:l}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(r)throw r.error}}return t}else return[[-1]]}lt.makeLeafArray=Br;function Wr(o,r,e,t){for(var n=r,s=0;s<e.length;s++)n+=o[s]*e[s];if(n===0){var i=X.tauRandInt(2,t);return i}else return n>0?0:1}function Yr(o,r,e){for(var t=0;r.children[t][0]>0;){var n=Wr(r.hyperplanes[t],r.offsets[t],o,e);n===0?t=r.children[t][0]:t=r.children[t][1]}var s=-1*r.children[t][0];return r.indices[s]}lt.searchFlatTree=Yr;var Gr=I&&I.__createBinding||(Object.create?function(o,r,e,t){t===void 0&&(t=e),Object.defineProperty(o,t,{enumerable:!0,get:function(){return r[e]}})}:function(o,r,e,t){t===void 0&&(t=e),o[t]=r[e]}),Kr=I&&I.__setModuleDefault||(Object.create?function(o,r){Object.defineProperty(o,"default",{enumerable:!0,value:r})}:function(o,r){o.default=r}),Ct=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)e!=="default"&&Object.hasOwnProperty.call(o,e)&&Gr(r,o,e);return Kr(r,o),r},_e=I&&I.__values||function(o){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&o[r],t=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&t>=o.length&&(o=void 0),{value:o&&o[t++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(ut,"__esModule",{value:!0});ut.initializeSearch=ut.makeInitializedNNSearch=ut.makeInitializations=ut.makeNNDescent=void 0;var A=Ct(K),Qr=Ct(q),Jr=Ct(lt),Ne=Ct($);function Zr(o,r){return function(t,n,s,i,l,u,h,f){i===void 0&&(i=10),l===void 0&&(l=50),u===void 0&&(u=.001),h===void 0&&(h=.5),f===void 0&&(f=!0);for(var a=t.length,g=A.makeHeap(t.length,s),v=0;v<t.length;v++)for(var m=A.rejectionSample(s,t.length,r),w=0;w<m.length;w++){var y=o(t[v],t[m[w]]);A.heapPush(g,v,y,m[w],1),A.heapPush(g,m[w],y,v,1)}if(f)for(var c=0;c<n.length;c++)for(var v=0;v<n[c].length&&!(n[c][v]<0);v++)for(var w=v+1;w<n[c].length&&!(n[c][w]<0);w++){var y=o(t[n[c][v]],t[n[c][w]]);A.heapPush(g,n[c][v],y,n[c][w],1),A.heapPush(g,n[c][w],y,n[c][v],1)}for(var c=0;c<i;c++){for(var d=A.buildCandidates(g,a,s,l,r),M=0,v=0;v<a;v++)for(var w=0;w<l;w++){var _=Math.floor(d[0][v][w]);if(!(_<0||Ne.tauRand(r)<h))for(var R=0;R<l;R++){var T=Math.floor(d[0][v][R]),N=d[2][v][w],k=d[2][v][R];if(!(T<0||!N&&!k)){var y=o(t[_],t[T]);M+=A.heapPush(g,_,y,T,1),M+=A.heapPush(g,T,y,_,1)}}}if(M<=u*s*t.length)break}var D=A.deheapSort(g);return D}}ut.makeNNDescent=Zr;function Xr(o){function r(t,n,s,i,l){for(var u=0;u<s.length;u++)for(var h=Ne.rejectionSample(t,n.length,l),f=0;f<h.length;f++)if(!(h[f]<0)){var a=o(n[h[f]],s[u]);A.heapPush(i,u,a,h[f],1)}}function e(t,n,s,i,l){for(var u=0;u<s.length;u++)for(var h=Jr.searchFlatTree(s[u],t,l),f=0;f<h.length;f++){if(h[f]<0)return;var a=o(n[h[f]],s[u]);A.heapPush(i,u,a,h[f],1)}}return{initFromRandom:r,initFromTree:e}}ut.makeInitializations=Xr;function Ar(o){return function(e,t,n,s){for(var i,l,u=Qr.getCSR(t),h=u.indices,f=u.indptr,a=0;a<s.length;a++)for(var g=new Set(n[0][a]);;){var v=A.smallestFlagged(n,a);if(v===-1)break;var m=h.slice(f[v],f[v+1]);try{for(var w=(i=void 0,_e(m)),y=w.next();!y.done;y=w.next()){var c=y.value;if(!(c===v||c===-1||g.has(c))){var d=o(e[c],s[a]);A.uncheckedHeapPush(n,a,d,c,1),g.add(c)}}}catch(M){i={error:M}}finally{try{y&&!y.done&&(l=w.return)&&l.call(w)}finally{if(i)throw i.error}}}return n}}ut.makeInitializedNNSearch=Ar;function Hr(o,r,e,t,n,s,i){var l,u,h=A.makeHeap(e.length,t);if(n(t,r,e,h,i),o)try{for(var f=_e(o),a=f.next();!a.done;a=f.next()){var g=a.value;s(g,r,e,h,i)}}catch(v){l={error:v}}finally{try{a&&!a.done&&(u=f.return)&&u.call(f)}finally{if(l)throw l.error}}return h}ut.initializeSearch=Hr;const tn=Object.prototype.toString;function Yt(o){return tn.call(o).endsWith("Array]")}function le(o,r,e){let t=0;const n=e(r);for(let s=0;s<o.x.length;s++)t+=Math.abs(o.y[s]-n(o.x[s]));return t}var F={};const en=Object.prototype.toString;function Et(o){const r=en.call(o);return r.endsWith("Array]")&&!r.includes("Big")}const rn=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:Et},Symbol.toStringTag,{value:"Module"})),nn=te(rn);function sn(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Et(o))throw new TypeError("input must be an array");if(o.length===0)throw new TypeError("input must not be empty");var e=r.fromIndex,t=e===void 0?0:e,n=r.toIndex,s=n===void 0?o.length:n;if(t<0||t>=o.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=t||s>o.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var i=o[t],l=t+1;l<s;l++)o[l]>i&&(i=o[l]);return i}function on(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Et(o))throw new TypeError("input must be an array");if(o.length===0)throw new TypeError("input must not be empty");var e=r.fromIndex,t=e===void 0?0:e,n=r.toIndex,s=n===void 0?o.length:n;if(t<0||t>=o.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=t||s>o.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var i=o[t],l=t+1;l<s;l++)o[l]<i&&(i=o[l]);return i}function ln(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Et(o)){if(o.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var e;if(r.output!==void 0){if(!Et(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(o.length);var t=on(o),n=sn(o);if(t===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=r.min,i=s===void 0?r.autoMinMax?t:0:s,l=r.max,u=l===void 0?r.autoMinMax?n:1:l;if(i>=u)throw new RangeError("min option must be smaller than max option");for(var h=(u-i)/(n-t),f=0;f<o.length;f++)e[f]=(o[f]-t)*h+i;return e}const hn=Object.freeze(Object.defineProperty({__proto__:null,default:ln},Symbol.toStringTag,{value:"Module"})),un=te(hn);Object.defineProperty(F,"__esModule",{value:!0});var H=nn,he=un;const Nt=" ".repeat(2),ke=" ".repeat(4);function an(){return Ie(this)}function Ie(o,r={}){const{maxRows:e=15,maxColumns:t=10,maxNumSize:n=8,padMinus:s="auto"}=r;return`${o.constructor.name} {
${Nt}[
${ke}${fn(o,e,t,n,s)}
${Nt}]
${Nt}rows: ${o.rows}
${Nt}columns: ${o.columns}
}`}function fn(o,r,e,t,n){const{rows:s,columns:i}=o,l=Math.min(s,r),u=Math.min(i,e),h=[];if(n==="auto"){n=!1;t:for(let f=0;f<l;f++)for(let a=0;a<u;a++)if(o.get(f,a)<0){n=!0;break t}}for(let f=0;f<l;f++){let a=[];for(let g=0;g<u;g++)a.push(cn(o.get(f,g),t,n));h.push(`${a.join(" ")}`)}return u!==i&&(h[h.length-1]+=` ... ${i-e} more columns`),l!==s&&h.push(`... ${s-r} more rows`),h.join(`
${ke}`)}function cn(o,r,e){return(o>=0&&e?` ${ue(o,r-1)}`:ue(o,r)).padEnd(r)}function ue(o,r){let e=o.toString();if(e.length<=r)return e;let t=o.toFixed(r);if(t.length>r&&(t=o.toFixed(Math.max(0,r-(t.length-r)))),t.length<=r&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let n=o.toExponential(r);return n.length>r&&(n=o.toExponential(Math.max(0,r-(n.length-r)))),n.slice(0)}function gn(o,r){o.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},o.prototype.addS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)+t);return this},o.prototype.addM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)+t.get(n,s));return this},o.add=function(t,n){return new r(t).add(n)},o.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},o.prototype.subS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)-t);return this},o.prototype.subM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)-t.get(n,s));return this},o.sub=function(t,n){return new r(t).sub(n)},o.prototype.subtract=o.prototype.sub,o.prototype.subtractS=o.prototype.subS,o.prototype.subtractM=o.prototype.subM,o.subtract=o.sub,o.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},o.prototype.mulS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)*t);return this},o.prototype.mulM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)*t.get(n,s));return this},o.mul=function(t,n){return new r(t).mul(n)},o.prototype.multiply=o.prototype.mul,o.prototype.multiplyS=o.prototype.mulS,o.prototype.multiplyM=o.prototype.mulM,o.multiply=o.mul,o.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},o.prototype.divS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)/t);return this},o.prototype.divM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)/t.get(n,s));return this},o.div=function(t,n){return new r(t).div(n)},o.prototype.divide=o.prototype.div,o.prototype.divideS=o.prototype.divS,o.prototype.divideM=o.prototype.divM,o.divide=o.div,o.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},o.prototype.modS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)%t);return this},o.prototype.modM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)%t.get(n,s));return this},o.mod=function(t,n){return new r(t).mod(n)},o.prototype.modulus=o.prototype.mod,o.prototype.modulusS=o.prototype.modS,o.prototype.modulusM=o.prototype.modM,o.modulus=o.mod,o.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},o.prototype.andS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)&t);return this},o.prototype.andM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)&t.get(n,s));return this},o.and=function(t,n){return new r(t).and(n)},o.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},o.prototype.orS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)|t);return this},o.prototype.orM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)|t.get(n,s));return this},o.or=function(t,n){return new r(t).or(n)},o.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},o.prototype.xorS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)^t);return this},o.prototype.xorM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)^t.get(n,s));return this},o.xor=function(t,n){return new r(t).xor(n)},o.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},o.prototype.leftShiftS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)<<t);return this},o.prototype.leftShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)<<t.get(n,s));return this},o.leftShift=function(t,n){return new r(t).leftShift(n)},o.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},o.prototype.signPropagatingRightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>t);return this},o.prototype.signPropagatingRightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>t.get(n,s));return this},o.signPropagatingRightShift=function(t,n){return new r(t).signPropagatingRightShift(n)},o.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},o.prototype.rightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>>t);return this},o.prototype.rightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>>t.get(n,s));return this},o.rightShift=function(t,n){return new r(t).rightShift(n)},o.prototype.zeroFillRightShift=o.prototype.rightShift,o.prototype.zeroFillRightShiftS=o.prototype.rightShiftS,o.prototype.zeroFillRightShiftM=o.prototype.rightShiftM,o.zeroFillRightShift=o.rightShift,o.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,~this.get(t,n));return this},o.not=function(t){return new r(t).not()},o.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.abs(this.get(t,n)));return this},o.abs=function(t){return new r(t).abs()},o.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acos(this.get(t,n)));return this},o.acos=function(t){return new r(t).acos()},o.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acosh(this.get(t,n)));return this},o.acosh=function(t){return new r(t).acosh()},o.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asin(this.get(t,n)));return this},o.asin=function(t){return new r(t).asin()},o.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asinh(this.get(t,n)));return this},o.asinh=function(t){return new r(t).asinh()},o.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atan(this.get(t,n)));return this},o.atan=function(t){return new r(t).atan()},o.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atanh(this.get(t,n)));return this},o.atanh=function(t){return new r(t).atanh()},o.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cbrt(this.get(t,n)));return this},o.cbrt=function(t){return new r(t).cbrt()},o.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.ceil(this.get(t,n)));return this},o.ceil=function(t){return new r(t).ceil()},o.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.clz32(this.get(t,n)));return this},o.clz32=function(t){return new r(t).clz32()},o.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cos(this.get(t,n)));return this},o.cos=function(t){return new r(t).cos()},o.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cosh(this.get(t,n)));return this},o.cosh=function(t){return new r(t).cosh()},o.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.exp(this.get(t,n)));return this},o.exp=function(t){return new r(t).exp()},o.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.expm1(this.get(t,n)));return this},o.expm1=function(t){return new r(t).expm1()},o.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.floor(this.get(t,n)));return this},o.floor=function(t){return new r(t).floor()},o.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.fround(this.get(t,n)));return this},o.fround=function(t){return new r(t).fround()},o.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log(this.get(t,n)));return this},o.log=function(t){return new r(t).log()},o.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log1p(this.get(t,n)));return this},o.log1p=function(t){return new r(t).log1p()},o.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log10(this.get(t,n)));return this},o.log10=function(t){return new r(t).log10()},o.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log2(this.get(t,n)));return this},o.log2=function(t){return new r(t).log2()},o.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.round(this.get(t,n)));return this},o.round=function(t){return new r(t).round()},o.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sign(this.get(t,n)));return this},o.sign=function(t){return new r(t).sign()},o.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sin(this.get(t,n)));return this},o.sin=function(t){return new r(t).sin()},o.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sinh(this.get(t,n)));return this},o.sinh=function(t){return new r(t).sinh()},o.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sqrt(this.get(t,n)));return this},o.sqrt=function(t){return new r(t).sqrt()},o.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tan(this.get(t,n)));return this},o.tan=function(t){return new r(t).tan()},o.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tanh(this.get(t,n)));return this},o.tanh=function(t){return new r(t).tanh()},o.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.trunc(this.get(t,n)));return this},o.trunc=function(t){return new r(t).trunc()},o.pow=function(t,n){return new r(t).pow(n)},o.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},o.prototype.powS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,mt(this.get(n,s),t));return this},o.prototype.powM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,mt(this.get(n,s),t.get(n,s)));return this}}function nt(o,r,e){let t=e?o.rows:o.rows-1;if(r<0||r>t)throw new RangeError("Row index out of range")}function st(o,r,e){let t=e?o.columns:o.columns-1;if(r<0||r>t)throw new RangeError("Column index out of range")}function wt(o,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==o.columns)throw new RangeError("vector size must be the same as the number of columns");return r}function vt(o,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==o.rows)throw new RangeError("vector size must be the same as the number of rows");return r}function re(o,r){if(!H.isAnyArray(r))throw new TypeError("row indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=o.rows)throw new RangeError("row indices are out of range")}function ne(o,r){if(!H.isAnyArray(r))throw new TypeError("column indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=o.columns)throw new RangeError("column indices are out of range")}function Xt(o,r,e,t,n){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(kt("startRow",r),kt("endRow",e),kt("startColumn",t),kt("endColumn",n),r>e||t>n||r<0||r>=o.rows||e<0||e>=o.rows||t<0||t>=o.columns||n<0||n>=o.columns)throw new RangeError("Submatrix indices are out of range")}function Lt(o,r=0){let e=[];for(let t=0;t<o;t++)e.push(r);return e}function kt(o,r){if(typeof r!="number")throw new TypeError(`${o} must be a number`)}function pt(o){if(o.isEmpty())throw new Error("Empty matrix has no elements to index")}function mn(o){let r=Lt(o.rows);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[e]+=o.get(e,t);return r}function pn(o){let r=Lt(o.columns);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[t]+=o.get(e,t);return r}function wn(o){let r=0;for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)r+=o.get(e,t);return r}function vn(o){let r=Lt(o.rows,1);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[e]*=o.get(e,t);return r}function dn(o){let r=Lt(o.columns,1);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[t]*=o.get(e,t);return r}function yn(o){let r=1;for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)r*=o.get(e,t);return r}function Sn(o,r,e){const t=o.rows,n=o.columns,s=[];for(let i=0;i<t;i++){let l=0,u=0,h=0;for(let f=0;f<n;f++)h=o.get(i,f)-e[i],l+=h,u+=h*h;r?s.push((u-l*l/n)/(n-1)):s.push((u-l*l/n)/n)}return s}function bn(o,r,e){const t=o.rows,n=o.columns,s=[];for(let i=0;i<n;i++){let l=0,u=0,h=0;for(let f=0;f<t;f++)h=o.get(f,i)-e[i],l+=h,u+=h*h;r?s.push((u-l*l/t)/(t-1)):s.push((u-l*l/t)/t)}return s}function Mn(o,r,e){const t=o.rows,n=o.columns,s=t*n;let i=0,l=0,u=0;for(let h=0;h<t;h++)for(let f=0;f<n;f++)u=o.get(h,f)-e,i+=u,l+=u*u;return r?(l-i*i/s)/(s-1):(l-i*i/s)/s}function En(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r[e])}function jn(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r[t])}function Rn(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r)}function _n(o){const r=[];for(let e=0;e<o.rows;e++){let t=0;for(let n=0;n<o.columns;n++)t+=mt(o.get(e,n),2)/(o.columns-1);r.push(Math.sqrt(t))}return r}function Nn(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r[e])}function kn(o){const r=[];for(let e=0;e<o.columns;e++){let t=0;for(let n=0;n<o.rows;n++)t+=mt(o.get(n,e),2)/(o.rows-1);r.push(Math.sqrt(t))}return r}function In(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r[t])}function zn(o){const r=o.size-1;let e=0;for(let t=0;t<o.columns;t++)for(let n=0;n<o.rows;n++)e+=mt(o.get(n,t),2)/r;return Math.sqrt(e)}function Pn(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r)}class P{static from1DArray(r,e,t){if(r*e!==t.length)throw new RangeError("data length does not match given dimensions");let s=new j(r,e);for(let i=0;i<r;i++)for(let l=0;l<e;l++)s.set(i,l,t[i*e+l]);return s}static rowVector(r){let e=new j(1,r.length);for(let t=0;t<r.length;t++)e.set(0,t,r[t]);return e}static columnVector(r){let e=new j(r.length,1);for(let t=0;t<r.length;t++)e.set(t,0,r[t]);return e}static zeros(r,e){return new j(r,e)}static ones(r,e){return new j(r,e).fill(1)}static rand(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:n=Math.random}=t;let s=new j(r,e);for(let i=0;i<r;i++)for(let l=0;l<e;l++)s.set(i,l,n());return s}static randInt(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:s=1e3,random:i=Math.random}=t;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(n>=s)throw new RangeError("min must be smaller than max");let l=s-n,u=new j(r,e);for(let h=0;h<r;h++)for(let f=0;f<e;f++){let a=n+Math.round(i()*l);u.set(h,f,a)}return u}static eye(r,e,t){e===void 0&&(e=r),t===void 0&&(t=1);let n=Math.min(r,e),s=this.zeros(r,e);for(let i=0;i<n;i++)s.set(i,i,t);return s}static diag(r,e,t){let n=r.length;e===void 0&&(e=n),t===void 0&&(t=e);let s=Math.min(n,e,t),i=this.zeros(e,t);for(let l=0;l<s;l++)i.set(l,l,r[l]);return i}static min(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,n=r.columns,s=new j(t,n);for(let i=0;i<t;i++)for(let l=0;l<n;l++)s.set(i,l,Math.min(r.get(i,l),e.get(i,l)));return s}static max(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,n=r.columns,s=new this(t,n);for(let i=0;i<t;i++)for(let l=0;l<n;l++)s.set(i,l,Math.max(r.get(i,l),e.get(i,l)));return s}static checkMatrix(r){return P.isMatrix(r)?r:new j(r)}static isMatrix(r){return r!=null&&r.klass==="Matrix"}get size(){return this.rows*this.columns}apply(r){if(typeof r!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.call(this,e,t);return this}to1DArray(){let r=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}to2DArray(){let r=[];for(let e=0;e<this.rows;e++){r.push([]);for(let t=0;t<this.columns;t++)r[e].push(this.get(e,t))}return r}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let r=0;r<this.rows;r++)for(let e=0;e<=r;e++)if(this.get(r,e)!==this.get(e,r))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let r=0;r<this.rows;r++)if(this.get(r,r)!==0)return!1;return!0}isEchelonForm(){let r=0,e=0,t=-1,n=!0,s=!1;for(;r<this.rows&&n;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(s=!0,t=e):(n=!1,s=!0);r++}return n}isReducedEchelonForm(){let r=0,e=0,t=-1,n=!0,s=!1;for(;r<this.rows&&n;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(s=!0,t=e):(n=!1,s=!0);for(let i=e+1;i<this.rows;i++)this.get(r,i)!==0&&(n=!1);r++}return n}echelonForm(){let r=this.clone(),e=0,t=0;for(;e<r.rows&&t<r.columns;){let n=e;for(let s=e;s<r.rows;s++)r.get(s,t)>r.get(n,t)&&(n=s);if(r.get(n,t)===0)t++;else{r.swapRows(e,n);let s=r.get(e,t);for(let i=t;i<r.columns;i++)r.set(e,i,r.get(e,i)/s);for(let i=e+1;i<r.rows;i++){let l=r.get(i,t)/r.get(e,t);r.set(i,t,0);for(let u=t+1;u<r.columns;u++)r.set(i,u,r.get(i,u)-r.get(e,u)*l)}e++,t++}}return r}reducedEchelonForm(){let r=this.echelonForm(),e=r.columns,t=r.rows,n=t-1;for(;n>=0;)if(r.maxRow(n)===0)n--;else{let s=0,i=!1;for(;s<t&&i===!1;)r.get(n,s)===1?i=!0:s++;for(let l=0;l<n;l++){let u=r.get(l,s);for(let h=s;h<e;h++){let f=r.get(l,h)-u*r.get(n,h);r.set(l,h,f)}}n--}return r}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:t=1}=r;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let n=new j(this.rows*e,this.columns*t);for(let s=0;s<e;s++)for(let i=0;i<t;i++)n.setSubMatrix(this,this.rows*s,this.columns*i);return n}fill(r){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,r);return this}neg(){return this.mulS(-1)}getRow(r){nt(this,r);let e=[];for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}getRowVector(r){return j.rowVector(this.getRow(r))}setRow(r,e){nt(this,r),e=wt(this,e);for(let t=0;t<this.columns;t++)this.set(r,t,e[t]);return this}swapRows(r,e){nt(this,r),nt(this,e);for(let t=0;t<this.columns;t++){let n=this.get(r,t);this.set(r,t,this.get(e,t)),this.set(e,t,n)}return this}getColumn(r){st(this,r);let e=[];for(let t=0;t<this.rows;t++)e.push(this.get(t,r));return e}getColumnVector(r){return j.columnVector(this.getColumn(r))}setColumn(r,e){st(this,r),e=vt(this,e);for(let t=0;t<this.rows;t++)this.set(t,r,e[t]);return this}swapColumns(r,e){st(this,r),st(this,e);for(let t=0;t<this.rows;t++){let n=this.get(t,r);this.set(t,r,this.get(t,e)),this.set(t,e,n)}return this}addRowVector(r){r=wt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[t]);return this}subRowVector(r){r=wt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[t]);return this}mulRowVector(r){r=wt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[t]);return this}divRowVector(r){r=wt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[t]);return this}addColumnVector(r){r=vt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[e]);return this}subColumnVector(r){r=vt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[e]);return this}mulColumnVector(r){r=vt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[e]);return this}divColumnVector(r){r=vt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[e]);return this}mulRow(r,e){nt(this,r);for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e);return this}mulColumn(r,e){st(this,r);for(let t=0;t<this.rows;t++)this.set(t,r,this.get(t,r)*e);return this}max(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e[t]&&(e[t]=this.get(t,n));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e[n]&&(e[n]=this.get(t,n));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n));return e}default:throw new Error(`invalid option: ${r}`)}}maxIndex(){pt(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>r&&(r=this.get(t,n),e[0]=t,e[1]=n);return e}min(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e[t]&&(e[t]=this.get(t,n));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e[n]&&(e[n]=this.get(t,n));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n));return e}default:throw new Error(`invalid option: ${r}`)}}minIndex(){pt(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<r&&(r=this.get(t,n),e[0]=t,e[1]=n);return e}maxRow(r){if(nt(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxRowIndex(r){nt(this,r),pt(this);let e=this.get(r,0),t=[r,0];for(let n=1;n<this.columns;n++)this.get(r,n)>e&&(e=this.get(r,n),t[1]=n);return t}minRow(r){if(nt(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)<e&&(e=this.get(r,t));return e}minRowIndex(r){nt(this,r),pt(this);let e=this.get(r,0),t=[r,0];for(let n=1;n<this.columns;n++)this.get(r,n)<e&&(e=this.get(r,n),t[1]=n);return t}maxColumn(r){if(st(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxColumnIndex(r){st(this,r),pt(this);let e=this.get(0,r),t=[0,r];for(let n=1;n<this.rows;n++)this.get(n,r)>e&&(e=this.get(n,r),t[0]=n);return t}minColumn(r){if(st(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)<e&&(e=this.get(t,r));return e}minColumnIndex(r){st(this,r),pt(this);let e=this.get(0,r),t=[0,r];for(let n=1;n<this.rows;n++)this.get(n,r)<e&&(e=this.get(n,r),t[0]=n);return t}diag(){let r=Math.min(this.rows,this.columns),e=[];for(let t=0;t<r;t++)e.push(this.get(t,t));return e}norm(r="frobenius"){switch(r){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${r}`)}}cumulativeSum(){let r=0;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r+=this.get(e,t),this.set(e,t,r);return this}dot(r){P.isMatrix(r)&&(r=r.to1DArray());let e=this.to1DArray();if(e.length!==r.length)throw new RangeError("vectors do not have the same size");let t=0;for(let n=0;n<e.length;n++)t+=e[n]*r[n];return t}mmul(r){r=j.checkMatrix(r);let e=this.rows,t=this.columns,n=r.columns,s=new j(e,n),i=new Float64Array(t);for(let l=0;l<n;l++){for(let u=0;u<t;u++)i[u]=r.get(u,l);for(let u=0;u<e;u++){let h=0;for(let f=0;f<t;f++)h+=this.get(u,f)*i[f];s.set(u,l,h)}}return s}mpow(r){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(r)||r<0)throw new RangeError("Exponent must be a non-negative integer");let e=j.eye(this.rows),t=this;for(let n=r;n>=1;n/=2)n&1&&(e=e.mmul(t)),t=t.mmul(t);return e}strassen2x2(r){r=j.checkMatrix(r);let e=new j(2,2);const t=this.get(0,0),n=r.get(0,0),s=this.get(0,1),i=r.get(0,1),l=this.get(1,0),u=r.get(1,0),h=this.get(1,1),f=r.get(1,1),a=(t+h)*(n+f),g=(l+h)*n,v=t*(i-f),m=h*(u-n),w=(t+s)*f,y=(l-t)*(n+i),c=(s-h)*(u+f),d=a+m-w+c,M=v+w,_=g+m,R=a-g+v+y;return e.set(0,0,d),e.set(0,1,M),e.set(1,0,_),e.set(1,1,R),e}strassen3x3(r){r=j.checkMatrix(r);let e=new j(3,3);const t=this.get(0,0),n=this.get(0,1),s=this.get(0,2),i=this.get(1,0),l=this.get(1,1),u=this.get(1,2),h=this.get(2,0),f=this.get(2,1),a=this.get(2,2),g=r.get(0,0),v=r.get(0,1),m=r.get(0,2),w=r.get(1,0),y=r.get(1,1),c=r.get(1,2),d=r.get(2,0),M=r.get(2,1),_=r.get(2,2),R=(t+n+s-i-l-f-a)*y,T=(t-i)*(-v+y),N=l*(-g+v+w-y-c-d+_),k=(-t+i+l)*(g-v+y),D=(i+l)*(-g+v),p=t*g,S=(-t+h+f)*(g-m+c),E=(-t+h)*(m-c),b=(h+f)*(-g+m),C=(t+n+s-l-u-h-f)*c,z=f*(-g+m+w-y-c-d+M),V=(-s+f+a)*(y+d-M),L=(s-a)*(y-M),U=s*d,Q=(f+a)*(-d+M),W=(-s+l+u)*(c+d-_),ht=(s-u)*(c-_),at=(l+u)*(-d+_),O=n*w,G=u*M,tt=i*m,et=h*v,Y=a*_,Ue=p+U+O,Be=R+k+D+p+V+U+Q,We=p+S+b+C+U+W+at,Ye=T+N+k+p+U+W+ht,Ge=T+k+D+p+G,Ke=U+W+ht+at+tt,Qe=p+S+E+z+V+L+U,Je=V+L+U+Q+et,Ze=p+S+E+b+Y;return e.set(0,0,Ue),e.set(0,1,Be),e.set(0,2,We),e.set(1,0,Ye),e.set(1,1,Ge),e.set(1,2,Ke),e.set(2,0,Qe),e.set(2,1,Je),e.set(2,2,Ze),e}mmulStrassen(r){r=j.checkMatrix(r);let e=this.clone(),t=e.rows,n=e.columns,s=r.rows,i=r.columns;n!==s&&console.warn(`Multiplying ${t} x ${n} and ${s} x ${i} matrix: dimensions do not match.`);function l(a,g,v){let m=a.rows,w=a.columns;if(m===g&&w===v)return a;{let y=P.zeros(g,v);return y=y.setSubMatrix(a,0,0),y}}let u=Math.max(t,s),h=Math.max(n,i);e=l(e,u,h),r=l(r,u,h);function f(a,g,v,m){if(v<=512||m<=512)return a.mmul(g);v%2===1&&m%2===1?(a=l(a,v+1,m+1),g=l(g,v+1,m+1)):v%2===1?(a=l(a,v+1,m),g=l(g,v+1,m)):m%2===1&&(a=l(a,v,m+1),g=l(g,v,m+1));let w=parseInt(a.rows/2,10),y=parseInt(a.columns/2,10),c=a.subMatrix(0,w-1,0,y-1),d=g.subMatrix(0,w-1,0,y-1),M=a.subMatrix(0,w-1,y,a.columns-1),_=g.subMatrix(0,w-1,y,g.columns-1),R=a.subMatrix(w,a.rows-1,0,y-1),T=g.subMatrix(w,g.rows-1,0,y-1),N=a.subMatrix(w,a.rows-1,y,a.columns-1),k=g.subMatrix(w,g.rows-1,y,g.columns-1),D=f(P.add(c,N),P.add(d,k),w,y),p=f(P.add(R,N),d,w,y),S=f(c,P.sub(_,k),w,y),E=f(N,P.sub(T,d),w,y),b=f(P.add(c,M),k,w,y),C=f(P.sub(R,c),P.add(d,_),w,y),z=f(P.sub(M,N),P.add(T,k),w,y),V=P.add(D,E);V.sub(b),V.add(z);let L=P.add(S,b),U=P.add(p,E),Q=P.sub(D,p);Q.add(S),Q.add(C);let W=P.zeros(2*V.rows,2*V.columns);return W=W.setSubMatrix(V,0,0),W=W.setSubMatrix(L,V.rows,0),W=W.setSubMatrix(U,0,V.columns),W=W.setSubMatrix(Q,V.rows,V.columns),W.subMatrix(0,v-1,0,m-1)}return f(e,r,u,h)}scaleRows(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let n=new j(this.rows,this.columns);for(let s=0;s<this.rows;s++){const i=this.getRow(s);i.length>0&&he(i,{min:e,max:t,output:i}),n.setRow(s,i)}return n}scaleColumns(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let n=new j(this.rows,this.columns);for(let s=0;s<this.columns;s++){const i=this.getColumn(s);i.length&&he(i,{min:e,max:t,output:i}),n.setColumn(s,i)}return n}flipRows(){const r=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let t=0;t<r;t++){let n=this.get(e,t),s=this.get(e,this.columns-1-t);this.set(e,t,s),this.set(e,this.columns-1-t,n)}return this}flipColumns(){const r=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let t=0;t<r;t++){let n=this.get(t,e),s=this.get(this.rows-1-t,e);this.set(t,e,s),this.set(this.rows-1-t,e,n)}return this}kroneckerProduct(r){r=j.checkMatrix(r);let e=this.rows,t=this.columns,n=r.rows,s=r.columns,i=new j(e*n,t*s);for(let l=0;l<e;l++)for(let u=0;u<t;u++)for(let h=0;h<n;h++)for(let f=0;f<s;f++)i.set(n*l+h,s*u+f,this.get(l,u)*r.get(h,f));return i}kroneckerSum(r){if(r=j.checkMatrix(r),!this.isSquare()||!r.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,t=r.rows,n=this.kroneckerProduct(j.eye(t,t)),s=j.eye(e,e).kroneckerProduct(r);return n.add(s)}transpose(){let r=new j(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.set(t,e,this.get(e,t));return r}sortRows(r=ae){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(r));return this}sortColumns(r=ae){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(r));return this}subMatrix(r,e,t,n){Xt(this,r,e,t,n);let s=new j(e-r+1,n-t+1);for(let i=r;i<=e;i++)for(let l=t;l<=n;l++)s.set(i-r,l-t,this.get(i,l));return s}subMatrixRow(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.columns-1),e>t||e<0||e>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let n=new j(r.length,t-e+1);for(let s=0;s<r.length;s++)for(let i=e;i<=t;i++){if(r[s]<0||r[s]>=this.rows)throw new RangeError(`Row index out of range: ${r[s]}`);n.set(s,i-e,this.get(r[s],i))}return n}subMatrixColumn(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.rows-1),e>t||e<0||e>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let n=new j(t-e+1,r.length);for(let s=0;s<r.length;s++)for(let i=e;i<=t;i++){if(r[s]<0||r[s]>=this.columns)throw new RangeError(`Column index out of range: ${r[s]}`);n.set(i-e,s,this.get(i,r[s]))}return n}setSubMatrix(r,e,t){if(r=j.checkMatrix(r),r.isEmpty())return this;let n=e+r.rows-1,s=t+r.columns-1;Xt(this,e,n,t,s);for(let i=0;i<r.rows;i++)for(let l=0;l<r.columns;l++)this.set(e+i,t+l,r.get(i,l));return this}selection(r,e){re(this,r),ne(this,e);let t=new j(r.length,e.length);for(let n=0;n<r.length;n++){let s=r[n];for(let i=0;i<e.length;i++){let l=e[i];t.set(n,i,this.get(s,l))}}return t}trace(){let r=Math.min(this.rows,this.columns),e=0;for(let t=0;t<r;t++)e+=this.get(t,t);return e}clone(){return this.constructor.copy(this,new j(this.rows,this.columns))}static copy(r,e){for(const[t,n,s]of r.entries())e.set(t,n,s);return e}sum(r){switch(r){case"row":return mn(this);case"column":return pn(this);case void 0:return wn(this);default:throw new Error(`invalid option: ${r}`)}}product(r){switch(r){case"row":return vn(this);case"column":return dn(this);case void 0:return yn(this);default:throw new Error(`invalid option: ${r}`)}}mean(r){const e=this.sum(r);switch(r){case"row":{for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e}case"column":{for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${r}`)}}variance(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:n=this.mean(r)}=e;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(r){case"row":{if(!H.isAnyArray(n))throw new TypeError("mean must be an array");return Sn(this,t,n)}case"column":{if(!H.isAnyArray(n))throw new TypeError("mean must be an array");return bn(this,t,n)}case void 0:{if(typeof n!="number")throw new TypeError("mean must be a number");return Mn(this,t,n)}default:throw new Error(`invalid option: ${r}`)}}standardDeviation(r,e){typeof r=="object"&&(e=r,r=void 0);const t=this.variance(r,e);if(r===void 0)return Math.sqrt(t);for(let n=0;n<t.length;n++)t[n]=Math.sqrt(t[n]);return t}center(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:t=this.mean(r)}=e;switch(r){case"row":{if(!H.isAnyArray(t))throw new TypeError("center must be an array");return En(this,t),this}case"column":{if(!H.isAnyArray(t))throw new TypeError("center must be an array");return jn(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return Rn(this,t),this}default:throw new Error(`invalid option: ${r}`)}}scale(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");let t=e.scale;switch(r){case"row":{if(t===void 0)t=_n(this);else if(!H.isAnyArray(t))throw new TypeError("scale must be an array");return Nn(this,t),this}case"column":{if(t===void 0)t=kn(this);else if(!H.isAnyArray(t))throw new TypeError("scale must be an array");return In(this,t),this}case void 0:{if(t===void 0)t=zn(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return Pn(this,t),this}default:throw new Error(`invalid option: ${r}`)}}toString(r){return Ie(this,r)}[Symbol.iterator](){return this.entries()}*entries(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield[r,e,this.get(r,e)]}*values(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield this.get(r,e)}}P.prototype.klass="Matrix";typeof Symbol!="undefined"&&(P.prototype[Symbol.for("nodejs.util.inspect.custom")]=an);function ae(o,r){return o-r}function Tn(o){return o.every(r=>typeof r=="number")}P.random=P.rand;P.randomInt=P.randInt;P.diagonal=P.diag;P.prototype.diagonal=P.prototype.diag;P.identity=P.eye;P.prototype.negate=P.prototype.neg;P.prototype.tensorProduct=P.prototype.kroneckerProduct;var jt,At,dt;let j=(dt=class extends P{constructor(e,t){super();Bt(this,jt);oe(this,"data");if(dt.isMatrix(e))Wt(this,jt,At).call(this,e.rows,e.columns),dt.copy(e,this);else if(Number.isInteger(e)&&e>=0)Wt(this,jt,At).call(this,e,t);else if(H.isAnyArray(e)){const n=e;if(e=n.length,t=e?n[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let s=0;s<e;s++){if(n[s].length!==t)throw new RangeError("Inconsistent array dimensions");if(!Tn(n[s]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(n[s]))}this.rows=e,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(e,t,n){return this.data[e][t]=n,this}get(e,t){return this.data[e][t]}removeRow(e){return nt(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),nt(this,e,!0),t=Float64Array.from(wt(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){st(this,e);for(let t=0;t<this.rows;t++){const n=new Float64Array(this.columns-1);for(let s=0;s<e;s++)n[s]=this.data[t][s];for(let s=e+1;s<this.columns;s++)n[s-1]=this.data[t][s];this.data[t]=n}return this.columns-=1,this}addColumn(e,t){typeof t=="undefined"&&(t=e,e=this.columns),st(this,e,!0),t=vt(this,t);for(let n=0;n<this.rows;n++){const s=new Float64Array(this.columns+1);let i=0;for(;i<e;i++)s[i]=this.data[n][i];for(s[i++]=t[n];i<this.columns+1;i++)s[i]=this.data[n][i-1];this.data[n]=s}return this.columns+=1,this}},jt=new WeakSet,At=function(e,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let n=0;n<e;n++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=t},dt);gn(P,j);var J;const $t=class $t extends P{constructor(e){super();Bt(this,J,void 0);if(j.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");_t(this,J,j.copy(e,new j(e.rows,e.rows)))}else if(Number.isInteger(e)&&e>=0)_t(this,J,new j(e,e));else if(_t(this,J,new j(e)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return ot(this,J).size}get rows(){return ot(this,J).rows}get columns(){return ot(this,J).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return j.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}clone(){const e=new $t(this.diagonalSize);for(const[t,n,s]of this.upperRightEntries())e.set(t,n,s);return e}toMatrix(){return new j(this)}get(e,t){return ot(this,J).get(e,t)}set(e,t,n){return ot(this,J).set(e,t,n),ot(this,J).set(t,e,n),this}removeCross(e){return ot(this,J).removeRow(e),ot(this,J).removeColumn(e),this}addCross(e,t){t===void 0&&(t=e,e=this.diagonalSize);const n=t.slice();return n.splice(e,1),ot(this,J).addRow(e,n),ot(this,J).addColumn(e,t),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const t=[];for(const[n,s]of e.entries())s||t.push(n);t.reverse();for(const n of t)this.removeCross(n);return this}toCompact(){const{diagonalSize:e}=this,t=new Array(e*(e+1)/2);for(let n=0,s=0,i=0;i<t.length;i++)t[i]=this.get(s,n),++n>=e&&(n=++s);return t}static fromCompact(e){const t=e.length,n=(Math.sqrt(8*t+1)-1)/2;if(!Number.isInteger(n))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const s=new $t(n);for(let i=0,l=0,u=0;u<t;u++)s.set(i,l,e[u]),++i>=n&&(i=++l);return s}*upperRightEntries(){for(let e=0,t=0;e<this.diagonalSize;void 0){const n=this.get(e,t);yield[e,t,n],++t>=this.diagonalSize&&(t=++e)}}*upperRightValues(){for(let e=0,t=0;e<this.diagonalSize;void 0)yield this.get(e,t),++t>=this.diagonalSize&&(t=++e)}};J=new WeakMap;let gt=$t;gt.prototype.klassType="SymmetricMatrix";class qt extends gt{static isDistanceMatrix(r){return gt.isSymmetricMatrix(r)&&r.klassSubType==="DistanceMatrix"}constructor(r){if(super(r),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(r,e,t){return r===e&&(t=0),super.set(r,e,t)}addCross(r,e){return e===void 0&&(e=r,r=this.diagonalSize),e=e.slice(),e[r]=0,super.addCross(r,e)}toSymmetricMatrix(){return new gt(this)}clone(){const r=new qt(this.diagonalSize);for(const[e,t,n]of this.upperRightEntries())e!==t&&r.set(e,t,n);return r}toCompact(){const{diagonalSize:r}=this,e=(r-1)*r/2,t=new Array(e);for(let n=1,s=0,i=0;i<t.length;i++)t[i]=this.get(s,n),++n>=r&&(n=++s+1);return t}static fromCompact(r){const e=r.length;if(e===0)return new this(0);const t=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(r)}`);const n=new this(t);for(let s=1,i=0,l=0;l<e;l++)n.set(s,i,r[l]),++s>=t&&(s=++i+1);return n}}qt.prototype.klassSubType="DistanceMatrix";class ct extends P{constructor(r,e,t){super(),this.matrix=r,this.rows=e,this.columns=t}}class Fn extends ct{constructor(r,e){st(r,e),super(r,r.rows,1),this.column=e}set(r,e,t){return this.matrix.set(r,this.column,t),this}get(r){return this.matrix.get(r,this.column)}}class On extends ct{constructor(r,e){ne(r,e),super(r,r.rows,e.length),this.columnIndices=e}set(r,e,t){return this.matrix.set(r,this.columnIndices[e],t),this}get(r,e){return this.matrix.get(r,this.columnIndices[e])}}class $n extends ct{constructor(r){super(r,r.rows,r.columns)}set(r,e,t){return this.matrix.set(r,this.columns-e-1,t),this}get(r,e){return this.matrix.get(r,this.columns-e-1)}}class Dn extends ct{constructor(r){super(r,r.rows,r.columns)}set(r,e,t){return this.matrix.set(this.rows-r-1,e,t),this}get(r,e){return this.matrix.get(this.rows-r-1,e)}}class Vn extends ct{constructor(r,e){nt(r,e),super(r,1,r.columns),this.row=e}set(r,e,t){return this.matrix.set(this.row,e,t),this}get(r,e){return this.matrix.get(this.row,e)}}class Cn extends ct{constructor(r,e){re(r,e),super(r,e.length,r.columns),this.rowIndices=e}set(r,e,t){return this.matrix.set(this.rowIndices[r],e,t),this}get(r,e){return this.matrix.get(this.rowIndices[r],e)}}class Ft extends ct{constructor(r,e,t){re(r,e),ne(r,t),super(r,e.length,t.length),this.rowIndices=e,this.columnIndices=t}set(r,e,t){return this.matrix.set(this.rowIndices[r],this.columnIndices[e],t),this}get(r,e){return this.matrix.get(this.rowIndices[r],this.columnIndices[e])}}class Ln extends ct{constructor(r,e,t,n,s){Xt(r,e,t,n,s),super(r,t-e+1,s-n+1),this.startRow=e,this.startColumn=n}set(r,e,t){return this.matrix.set(this.startRow+r,this.startColumn+e,t),this}get(r,e){return this.matrix.get(this.startRow+r,this.startColumn+e)}}let qn=class extends ct{constructor(r){super(r,r.columns,r.rows)}set(r,e,t){return this.matrix.set(e,r,t),this}get(r,e){return this.matrix.get(e,r)}};class ze extends P{constructor(r,e={}){const{rows:t=1}=e;if(r.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=r.length/t,this.data=r}set(r,e,t){let n=this._calculateIndex(r,e);return this.data[n]=t,this}get(r,e){let t=this._calculateIndex(r,e);return this.data[t]}_calculateIndex(r,e){return r*this.columns+e}}class rt extends P{constructor(r){super(),this.data=r,this.rows=r.length,this.columns=r[0].length}set(r,e,t){return this.data[r][e]=t,this}get(r,e){return this.data[r][e]}}function xn(o,r){if(H.isAnyArray(o))return o[0]&&H.isAnyArray(o[0])?new rt(o):new ze(o,r);throw new Error("the argument is not an array")}class xt{constructor(r){r=rt.checkMatrix(r);let e=r.clone(),t=e.rows,n=e.columns,s=new Float64Array(t),i=1,l,u,h,f,a,g,v,m,w;for(l=0;l<t;l++)s[l]=l;for(m=new Float64Array(t),u=0;u<n;u++){for(l=0;l<t;l++)m[l]=e.get(l,u);for(l=0;l<t;l++){for(w=Math.min(l,u),a=0,h=0;h<w;h++)a+=e.get(l,h)*m[h];m[l]-=a,e.set(l,u,m[l])}for(f=u,l=u+1;l<t;l++)Math.abs(m[l])>Math.abs(m[f])&&(f=l);if(f!==u){for(h=0;h<n;h++)g=e.get(f,h),e.set(f,h,e.get(u,h)),e.set(u,h,g);v=s[f],s[f]=s[u],s[u]=v,i=-i}if(u<t&&e.get(u,u)!==0)for(l=u+1;l<t;l++)e.set(l,u,e.get(l,u)/e.get(u,u))}this.LU=e,this.pivotVector=s,this.pivotSign=i}isSingular(){let r=this.LU,e=r.columns;for(let t=0;t<e;t++)if(r.get(t,t)===0)return!0;return!1}solve(r){r=j.checkMatrix(r);let e=this.LU;if(e.rows!==r.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n=r.columns,s=r.subMatrixRow(this.pivotVector,0,n-1),i=e.columns,l,u,h;for(h=0;h<i;h++)for(l=h+1;l<i;l++)for(u=0;u<n;u++)s.set(l,u,s.get(l,u)-s.get(h,u)*e.get(l,h));for(h=i-1;h>=0;h--){for(u=0;u<n;u++)s.set(h,u,s.get(h,u)/e.get(h,h));for(l=0;l<h;l++)for(u=0;u<n;u++)s.set(l,u,s.get(l,u)-s.get(h,u)*e.get(l,h))}return s}get determinant(){let r=this.LU;if(!r.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,t=r.columns;for(let n=0;n<t;n++)e*=r.get(n,n);return e}get lowerTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,n=new j(e,t);for(let s=0;s<e;s++)for(let i=0;i<t;i++)s>i?n.set(s,i,r.get(s,i)):s===i?n.set(s,i,1):n.set(s,i,0);return n}get upperTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,n=new j(e,t);for(let s=0;s<e;s++)for(let i=0;i<t;i++)s<=i?n.set(s,i,r.get(s,i)):n.set(s,i,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ft(o,r){let e=0;return Math.abs(o)>Math.abs(r)?(e=r/o,Math.abs(o)*Math.sqrt(1+e*e)):r!==0?(e=o/r,Math.abs(r)*Math.sqrt(1+e*e)):0}class se{constructor(r){r=rt.checkMatrix(r);let e=r.clone(),t=r.rows,n=r.columns,s=new Float64Array(n),i,l,u,h;for(u=0;u<n;u++){let f=0;for(i=u;i<t;i++)f=ft(f,e.get(i,u));if(f!==0){for(e.get(u,u)<0&&(f=-f),i=u;i<t;i++)e.set(i,u,e.get(i,u)/f);for(e.set(u,u,e.get(u,u)+1),l=u+1;l<n;l++){for(h=0,i=u;i<t;i++)h+=e.get(i,u)*e.get(i,l);for(h=-h/e.get(u,u),i=u;i<t;i++)e.set(i,l,e.get(i,l)+h*e.get(i,u))}}s[u]=-f}this.QR=e,this.Rdiag=s}solve(r){r=j.checkMatrix(r);let e=this.QR,t=e.rows;if(r.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n=r.columns,s=r.clone(),i=e.columns,l,u,h,f;for(h=0;h<i;h++)for(u=0;u<n;u++){for(f=0,l=h;l<t;l++)f+=e.get(l,h)*s.get(l,u);for(f=-f/e.get(h,h),l=h;l<t;l++)s.set(l,u,s.get(l,u)+f*e.get(l,h))}for(h=i-1;h>=0;h--){for(u=0;u<n;u++)s.set(h,u,s.get(h,u)/this.Rdiag[h]);for(l=0;l<h;l++)for(u=0;u<n;u++)s.set(l,u,s.get(l,u)-s.get(h,u)*e.get(l,h))}return s.subMatrix(0,i-1,0,n-1)}isFullRank(){let r=this.QR.columns;for(let e=0;e<r;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let r=this.QR,e=r.columns,t=new j(e,e),n,s;for(n=0;n<e;n++)for(s=0;s<e;s++)n<s?t.set(n,s,r.get(n,s)):n===s?t.set(n,s,this.Rdiag[n]):t.set(n,s,0);return t}get orthogonalMatrix(){let r=this.QR,e=r.rows,t=r.columns,n=new j(e,t),s,i,l,u;for(l=t-1;l>=0;l--){for(s=0;s<e;s++)n.set(s,l,0);for(n.set(l,l,1),i=l;i<t;i++)if(r.get(l,l)!==0){for(u=0,s=l;s<e;s++)u+=r.get(s,l)*n.get(s,i);for(u=-u/r.get(l,l),s=l;s<e;s++)n.set(s,i,n.get(s,i)+u*r.get(s,l))}}return n}}class St{constructor(r,e={}){if(r=rt.checkMatrix(r),r.isEmpty())throw new Error("Matrix must be non-empty");let t=r.rows,n=r.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:i=!0,autoTranspose:l=!1}=e;let u=!!s,h=!!i,f=!1,a;if(t<n)if(!l)a=r.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{a=r.transpose(),t=a.rows,n=a.columns,f=!0;let p=u;u=h,h=p}else a=r.clone();let g=Math.min(t,n),v=Math.min(t+1,n),m=new Float64Array(v),w=new j(t,g),y=new j(n,n),c=new Float64Array(n),d=new Float64Array(t),M=new Float64Array(v);for(let p=0;p<v;p++)M[p]=p;let _=Math.min(t-1,n),R=Math.max(0,Math.min(n-2,t)),T=Math.max(_,R);for(let p=0;p<T;p++){if(p<_){m[p]=0;for(let S=p;S<t;S++)m[p]=ft(m[p],a.get(S,p));if(m[p]!==0){a.get(p,p)<0&&(m[p]=-m[p]);for(let S=p;S<t;S++)a.set(S,p,a.get(S,p)/m[p]);a.set(p,p,a.get(p,p)+1)}m[p]=-m[p]}for(let S=p+1;S<n;S++){if(p<_&&m[p]!==0){let E=0;for(let b=p;b<t;b++)E+=a.get(b,p)*a.get(b,S);E=-E/a.get(p,p);for(let b=p;b<t;b++)a.set(b,S,a.get(b,S)+E*a.get(b,p))}c[S]=a.get(p,S)}if(u&&p<_)for(let S=p;S<t;S++)w.set(S,p,a.get(S,p));if(p<R){c[p]=0;for(let S=p+1;S<n;S++)c[p]=ft(c[p],c[S]);if(c[p]!==0){c[p+1]<0&&(c[p]=0-c[p]);for(let S=p+1;S<n;S++)c[S]/=c[p];c[p+1]+=1}if(c[p]=-c[p],p+1<t&&c[p]!==0){for(let S=p+1;S<t;S++)d[S]=0;for(let S=p+1;S<t;S++)for(let E=p+1;E<n;E++)d[S]+=c[E]*a.get(S,E);for(let S=p+1;S<n;S++){let E=-c[S]/c[p+1];for(let b=p+1;b<t;b++)a.set(b,S,a.get(b,S)+E*d[b])}}if(h)for(let S=p+1;S<n;S++)y.set(S,p,c[S])}}let N=Math.min(n,t+1);if(_<n&&(m[_]=a.get(_,_)),t<N&&(m[N-1]=0),R+1<N&&(c[R]=a.get(R,N-1)),c[N-1]=0,u){for(let p=_;p<g;p++){for(let S=0;S<t;S++)w.set(S,p,0);w.set(p,p,1)}for(let p=_-1;p>=0;p--)if(m[p]!==0){for(let S=p+1;S<g;S++){let E=0;for(let b=p;b<t;b++)E+=w.get(b,p)*w.get(b,S);E=-E/w.get(p,p);for(let b=p;b<t;b++)w.set(b,S,w.get(b,S)+E*w.get(b,p))}for(let S=p;S<t;S++)w.set(S,p,-w.get(S,p));w.set(p,p,1+w.get(p,p));for(let S=0;S<p-1;S++)w.set(S,p,0)}else{for(let S=0;S<t;S++)w.set(S,p,0);w.set(p,p,1)}}if(h)for(let p=n-1;p>=0;p--){if(p<R&&c[p]!==0)for(let S=p+1;S<n;S++){let E=0;for(let b=p+1;b<n;b++)E+=y.get(b,p)*y.get(b,S);E=-E/y.get(p+1,p);for(let b=p+1;b<n;b++)y.set(b,S,y.get(b,S)+E*y.get(b,p))}for(let S=0;S<n;S++)y.set(S,p,0);y.set(p,p,1)}let k=N-1,D=Number.EPSILON;for(;N>0;){let p,S;for(p=N-2;p>=-1&&p!==-1;p--){const E=Number.MIN_VALUE+D*Math.abs(m[p]+Math.abs(m[p+1]));if(Math.abs(c[p])<=E||Number.isNaN(c[p])){c[p]=0;break}}if(p===N-2)S=4;else{let E;for(E=N-1;E>=p&&E!==p;E--){let b=(E!==N?Math.abs(c[E]):0)+(E!==p+1?Math.abs(c[E-1]):0);if(Math.abs(m[E])<=D*b){m[E]=0;break}}E===p?S=3:E===N-1?S=1:(S=2,p=E)}switch(p++,S){case 1:{let E=c[N-2];c[N-2]=0;for(let b=N-2;b>=p;b--){let C=ft(m[b],E),z=m[b]/C,V=E/C;if(m[b]=C,b!==p&&(E=-V*c[b-1],c[b-1]=z*c[b-1]),h)for(let L=0;L<n;L++)C=z*y.get(L,b)+V*y.get(L,N-1),y.set(L,N-1,-V*y.get(L,b)+z*y.get(L,N-1)),y.set(L,b,C)}break}case 2:{let E=c[p-1];c[p-1]=0;for(let b=p;b<N;b++){let C=ft(m[b],E),z=m[b]/C,V=E/C;if(m[b]=C,E=-V*c[b],c[b]=z*c[b],u)for(let L=0;L<t;L++)C=z*w.get(L,b)+V*w.get(L,p-1),w.set(L,p-1,-V*w.get(L,b)+z*w.get(L,p-1)),w.set(L,b,C)}break}case 3:{const E=Math.max(Math.abs(m[N-1]),Math.abs(m[N-2]),Math.abs(c[N-2]),Math.abs(m[p]),Math.abs(c[p])),b=m[N-1]/E,C=m[N-2]/E,z=c[N-2]/E,V=m[p]/E,L=c[p]/E,U=((C+b)*(C-b)+z*z)/2,Q=b*z*(b*z);let W=0;(U!==0||Q!==0)&&(U<0?W=0-Math.sqrt(U*U+Q):W=Math.sqrt(U*U+Q),W=Q/(U+W));let ht=(V+b)*(V-b)+W,at=V*L;for(let O=p;O<N-1;O++){let G=ft(ht,at);G===0&&(G=Number.MIN_VALUE);let tt=ht/G,et=at/G;if(O!==p&&(c[O-1]=G),ht=tt*m[O]+et*c[O],c[O]=tt*c[O]-et*m[O],at=et*m[O+1],m[O+1]=tt*m[O+1],h)for(let Y=0;Y<n;Y++)G=tt*y.get(Y,O)+et*y.get(Y,O+1),y.set(Y,O+1,-et*y.get(Y,O)+tt*y.get(Y,O+1)),y.set(Y,O,G);if(G=ft(ht,at),G===0&&(G=Number.MIN_VALUE),tt=ht/G,et=at/G,m[O]=G,ht=tt*c[O]+et*m[O+1],m[O+1]=-et*c[O]+tt*m[O+1],at=et*c[O+1],c[O+1]=tt*c[O+1],u&&O<t-1)for(let Y=0;Y<t;Y++)G=tt*w.get(Y,O)+et*w.get(Y,O+1),w.set(Y,O+1,-et*w.get(Y,O)+tt*w.get(Y,O+1)),w.set(Y,O,G)}c[N-2]=ht;break}case 4:{if(m[p]<=0&&(m[p]=m[p]<0?-m[p]:0,h))for(let E=0;E<=k;E++)y.set(E,p,-y.get(E,p));for(;p<k&&!(m[p]>=m[p+1]);){let E=m[p];if(m[p]=m[p+1],m[p+1]=E,h&&p<n-1)for(let b=0;b<n;b++)E=y.get(b,p+1),y.set(b,p+1,y.get(b,p)),y.set(b,p,E);if(u&&p<t-1)for(let b=0;b<t;b++)E=w.get(b,p+1),w.set(b,p+1,w.get(b,p)),w.set(b,p,E);p++}N--;break}}}if(f){let p=y;y=w,w=p}this.m=t,this.n=n,this.s=m,this.U=w,this.V=y}solve(r){let e=r,t=this.threshold,n=this.s.length,s=j.zeros(n,n);for(let g=0;g<n;g++)Math.abs(this.s[g])<=t?s.set(g,g,0):s.set(g,g,1/this.s[g]);let i=this.U,l=this.rightSingularVectors,u=l.mmul(s),h=l.rows,f=i.rows,a=j.zeros(h,f);for(let g=0;g<h;g++)for(let v=0;v<f;v++){let m=0;for(let w=0;w<n;w++)m+=u.get(g,w)*i.get(v,w);a.set(g,v,m)}return a.mmul(e)}solveForDiagonal(r){return this.solve(j.diag(r))}inverse(){let r=this.V,e=this.threshold,t=r.rows,n=r.columns,s=new j(t,this.s.length);for(let f=0;f<t;f++)for(let a=0;a<n;a++)Math.abs(this.s[a])>e&&s.set(f,a,r.get(f,a)/this.s[a]);let i=this.U,l=i.rows,u=i.columns,h=new j(t,l);for(let f=0;f<t;f++)for(let a=0;a<l;a++){let g=0;for(let v=0;v<u;v++)g+=s.get(f,v)*i.get(a,v);h.set(f,a,g)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let r=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,t=this.s;for(let n=0,s=t.length;n<s;n++)t[n]>r&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return j.diag(this.s)}}function Un(o,r=!1){return o=rt.checkMatrix(o),r?new St(o).inverse():Pe(o,j.eye(o.rows))}function Pe(o,r,e=!1){return o=rt.checkMatrix(o),r=rt.checkMatrix(r),e?new St(o).solve(r):o.isSquare()?new xt(o).solve(r):new se(o).solve(r)}function Ot(o){if(o=j.checkMatrix(o),o.isSquare()){if(o.columns===0)return 1;let r,e,t,n;if(o.columns===2)return r=o.get(0,0),e=o.get(0,1),t=o.get(1,0),n=o.get(1,1),r*n-e*t;if(o.columns===3){let s,i,l;return s=new Ft(o,[1,2],[1,2]),i=new Ft(o,[1,2],[0,2]),l=new Ft(o,[1,2],[0,1]),r=o.get(0,0),e=o.get(0,1),t=o.get(0,2),r*Ot(s)-e*Ot(i)+t*Ot(l)}else return new xt(o).determinant}else throw Error("determinant can only be calculated for a square matrix")}function Bn(o,r){let e=[];for(let t=0;t<o;t++)t!==r&&e.push(t);return e}function Wn(o,r,e,t=1e-9,n=1e-9){if(o>n)return new Array(r.rows+1).fill(0);{let s=r.addRow(e,[0]);for(let i=0;i<s.rows;i++)Math.abs(s.get(i,0))<t&&s.set(i,0,0);return s.to1DArray()}}function Yn(o,r={}){const{thresholdValue:e=1e-9,thresholdError:t=1e-9}=r;o=j.checkMatrix(o);let n=o.rows,s=new j(n,n);for(let i=0;i<n;i++){let l=j.columnVector(o.getRow(i)),u=o.subMatrixRow(Bn(n,i)).transpose(),f=new St(u).solve(l),a=j.sub(l,u.mmul(f)).abs().max();s.setRow(i,Wn(a,f,i,e,t))}return s}function Gn(o,r=Number.EPSILON){if(o=j.checkMatrix(o),o.isEmpty())return o.transpose();let e=new St(o,{autoTranspose:!0}),t=e.leftSingularVectors,n=e.rightSingularVectors,s=e.diagonal;for(let i=0;i<s.length;i++)Math.abs(s[i])>r?s[i]=1/s[i]:s[i]=0;return n.mmul(j.diag(s).mmul(t.transpose()))}function Kn(o,r=o,e={}){o=new j(o);let t=!1;if(typeof r=="object"&&!j.isMatrix(r)&&!H.isAnyArray(r)?(e=r,r=o,t=!0):r=new j(r),o.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0}=e;n&&(o=o.center("column"),t||(r=r.center("column")));const s=o.transpose().mmul(r);for(let i=0;i<s.rows;i++)for(let l=0;l<s.columns;l++)s.set(i,l,s.get(i,l)*(1/(o.rows-1)));return s}function Qn(o,r=o,e={}){o=new j(o);let t=!1;if(typeof r=="object"&&!j.isMatrix(r)&&!H.isAnyArray(r)?(e=r,r=o,t=!0):r=new j(r),o.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0,scale:s=!0}=e;n&&(o.center("column"),t||r.center("column")),s&&(o.scale("column"),t||r.scale("column"));const i=o.standardDeviation("column",{unbiased:!0}),l=t?i:r.standardDeviation("column",{unbiased:!0}),u=o.transpose().mmul(r);for(let h=0;h<u.rows;h++)for(let f=0;f<u.columns;f++)u.set(h,f,u.get(h,f)*(1/(i[h]*l[f]))*(1/(o.rows-1)));return u}class Te{constructor(r,e={}){const{assumeSymmetric:t=!1}=e;if(r=rt.checkMatrix(r),!r.isSquare())throw new Error("Matrix is not a square matrix");if(r.isEmpty())throw new Error("Matrix must be non-empty");let n=r.columns,s=new j(n,n),i=new Float64Array(n),l=new Float64Array(n),u=r,h,f,a=!1;if(t?a=!0:a=r.isSymmetric(),a){for(h=0;h<n;h++)for(f=0;f<n;f++)s.set(h,f,u.get(h,f));Jn(n,l,i,s),Zn(n,l,i,s)}else{let g=new j(n,n),v=new Float64Array(n);for(f=0;f<n;f++)for(h=0;h<n;h++)g.set(h,f,u.get(h,f));Xn(n,g,v,s),An(n,l,i,s,g)}this.n=n,this.e=l,this.d=i,this.V=s}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let r=this.n,e=this.e,t=this.d,n=new j(r,r),s,i;for(s=0;s<r;s++){for(i=0;i<r;i++)n.set(s,i,0);n.set(s,s,t[s]),e[s]>0?n.set(s,s+1,e[s]):e[s]<0&&n.set(s,s-1,e[s])}return n}}function Jn(o,r,e,t){let n,s,i,l,u,h,f,a;for(u=0;u<o;u++)e[u]=t.get(o-1,u);for(l=o-1;l>0;l--){for(a=0,i=0,h=0;h<l;h++)a=a+Math.abs(e[h]);if(a===0)for(r[l]=e[l-1],u=0;u<l;u++)e[u]=t.get(l-1,u),t.set(l,u,0),t.set(u,l,0);else{for(h=0;h<l;h++)e[h]/=a,i+=e[h]*e[h];for(n=e[l-1],s=Math.sqrt(i),n>0&&(s=-s),r[l]=a*s,i=i-n*s,e[l-1]=n-s,u=0;u<l;u++)r[u]=0;for(u=0;u<l;u++){for(n=e[u],t.set(u,l,n),s=r[u]+t.get(u,u)*n,h=u+1;h<=l-1;h++)s+=t.get(h,u)*e[h],r[h]+=t.get(h,u)*n;r[u]=s}for(n=0,u=0;u<l;u++)r[u]/=i,n+=r[u]*e[u];for(f=n/(i+i),u=0;u<l;u++)r[u]-=f*e[u];for(u=0;u<l;u++){for(n=e[u],s=r[u],h=u;h<=l-1;h++)t.set(h,u,t.get(h,u)-(n*r[h]+s*e[h]));e[u]=t.get(l-1,u),t.set(l,u,0)}}e[l]=i}for(l=0;l<o-1;l++){if(t.set(o-1,l,t.get(l,l)),t.set(l,l,1),i=e[l+1],i!==0){for(h=0;h<=l;h++)e[h]=t.get(h,l+1)/i;for(u=0;u<=l;u++){for(s=0,h=0;h<=l;h++)s+=t.get(h,l+1)*t.get(h,u);for(h=0;h<=l;h++)t.set(h,u,t.get(h,u)-s*e[h])}}for(h=0;h<=l;h++)t.set(h,l+1,0)}for(u=0;u<o;u++)e[u]=t.get(o-1,u),t.set(o-1,u,0);t.set(o-1,o-1,1),r[0]=0}function Zn(o,r,e,t){let n,s,i,l,u,h,f,a,g,v,m,w,y,c,d,M;for(i=1;i<o;i++)r[i-1]=r[i];r[o-1]=0;let _=0,R=0,T=Number.EPSILON;for(h=0;h<o;h++){for(R=Math.max(R,Math.abs(e[h])+Math.abs(r[h])),f=h;f<o&&!(Math.abs(r[f])<=T*R);)f++;if(f>h)do{for(n=e[h],a=(e[h+1]-n)/(2*r[h]),g=ft(a,1),a<0&&(g=-g),e[h]=r[h]/(a+g),e[h+1]=r[h]*(a+g),v=e[h+1],s=n-e[h],i=h+2;i<o;i++)e[i]-=s;for(_=_+s,a=e[f],m=1,w=m,y=m,c=r[h+1],d=0,M=0,i=f-1;i>=h;i--)for(y=w,w=m,M=d,n=m*r[i],s=m*a,g=ft(a,r[i]),r[i+1]=d*g,d=r[i]/g,m=a/g,a=m*e[i]-d*n,e[i+1]=s+d*(m*n+d*e[i]),u=0;u<o;u++)s=t.get(u,i+1),t.set(u,i+1,d*t.get(u,i)+m*s),t.set(u,i,m*t.get(u,i)-d*s);a=-d*M*y*c*r[h]/v,r[h]=d*a,e[h]=m*a}while(Math.abs(r[h])>T*R);e[h]=e[h]+_,r[h]=0}for(i=0;i<o-1;i++){for(u=i,a=e[i],l=i+1;l<o;l++)e[l]<a&&(u=l,a=e[l]);if(u!==i)for(e[u]=e[i],e[i]=a,l=0;l<o;l++)a=t.get(l,i),t.set(l,i,t.get(l,u)),t.set(l,u,a)}}function Xn(o,r,e,t){let n=0,s=o-1,i,l,u,h,f,a,g;for(a=n+1;a<=s-1;a++){for(g=0,h=a;h<=s;h++)g=g+Math.abs(r.get(h,a-1));if(g!==0){for(u=0,h=s;h>=a;h--)e[h]=r.get(h,a-1)/g,u+=e[h]*e[h];for(l=Math.sqrt(u),e[a]>0&&(l=-l),u=u-e[a]*l,e[a]=e[a]-l,f=a;f<o;f++){for(i=0,h=s;h>=a;h--)i+=e[h]*r.get(h,f);for(i=i/u,h=a;h<=s;h++)r.set(h,f,r.get(h,f)-i*e[h])}for(h=0;h<=s;h++){for(i=0,f=s;f>=a;f--)i+=e[f]*r.get(h,f);for(i=i/u,f=a;f<=s;f++)r.set(h,f,r.get(h,f)-i*e[f])}e[a]=g*e[a],r.set(a,a-1,g*l)}}for(h=0;h<o;h++)for(f=0;f<o;f++)t.set(h,f,h===f?1:0);for(a=s-1;a>=n+1;a--)if(r.get(a,a-1)!==0){for(h=a+1;h<=s;h++)e[h]=r.get(h,a-1);for(f=a;f<=s;f++){for(l=0,h=a;h<=s;h++)l+=e[h]*t.get(h,f);for(l=l/e[a]/r.get(a,a-1),h=a;h<=s;h++)t.set(h,f,t.get(h,f)+l*e[h])}}}function An(o,r,e,t,n){let s=o-1,i=0,l=o-1,u=Number.EPSILON,h=0,f=0,a=0,g=0,v=0,m=0,w=0,y=0,c,d,M,_,R,T,N,k,D,p,S,E,b,C,z;for(c=0;c<o;c++)for((c<i||c>l)&&(e[c]=n.get(c,c),r[c]=0),d=Math.max(c-1,0);d<o;d++)f=f+Math.abs(n.get(c,d));for(;s>=i;){for(_=s;_>i&&(m=Math.abs(n.get(_-1,_-1))+Math.abs(n.get(_,_)),m===0&&(m=f),!(Math.abs(n.get(_,_-1))<u*m));)_--;if(_===s)n.set(s,s,n.get(s,s)+h),e[s]=n.get(s,s),r[s]=0,s--,y=0;else if(_===s-1){if(N=n.get(s,s-1)*n.get(s-1,s),a=(n.get(s-1,s-1)-n.get(s,s))/2,g=a*a+N,w=Math.sqrt(Math.abs(g)),n.set(s,s,n.get(s,s)+h),n.set(s-1,s-1,n.get(s-1,s-1)+h),k=n.get(s,s),g>=0){for(w=a>=0?a+w:a-w,e[s-1]=k+w,e[s]=e[s-1],w!==0&&(e[s]=k-N/w),r[s-1]=0,r[s]=0,k=n.get(s,s-1),m=Math.abs(k)+Math.abs(w),a=k/m,g=w/m,v=Math.sqrt(a*a+g*g),a=a/v,g=g/v,d=s-1;d<o;d++)w=n.get(s-1,d),n.set(s-1,d,g*w+a*n.get(s,d)),n.set(s,d,g*n.get(s,d)-a*w);for(c=0;c<=s;c++)w=n.get(c,s-1),n.set(c,s-1,g*w+a*n.get(c,s)),n.set(c,s,g*n.get(c,s)-a*w);for(c=i;c<=l;c++)w=t.get(c,s-1),t.set(c,s-1,g*w+a*t.get(c,s)),t.set(c,s,g*t.get(c,s)-a*w)}else e[s-1]=k+a,e[s]=k+a,r[s-1]=w,r[s]=-w;s=s-2,y=0}else{if(k=n.get(s,s),D=0,N=0,_<s&&(D=n.get(s-1,s-1),N=n.get(s,s-1)*n.get(s-1,s)),y===10){for(h+=k,c=i;c<=s;c++)n.set(c,c,n.get(c,c)-k);m=Math.abs(n.get(s,s-1))+Math.abs(n.get(s-1,s-2)),k=D=.75*m,N=-.4375*m*m}if(y===30&&(m=(D-k)/2,m=m*m+N,m>0)){for(m=Math.sqrt(m),D<k&&(m=-m),m=k-N/((D-k)/2+m),c=i;c<=s;c++)n.set(c,c,n.get(c,c)-m);h+=m,k=D=N=.964}for(y=y+1,R=s-2;R>=_&&(w=n.get(R,R),v=k-w,m=D-w,a=(v*m-N)/n.get(R+1,R)+n.get(R,R+1),g=n.get(R+1,R+1)-w-v-m,v=n.get(R+2,R+1),m=Math.abs(a)+Math.abs(g)+Math.abs(v),a=a/m,g=g/m,v=v/m,!(R===_||Math.abs(n.get(R,R-1))*(Math.abs(g)+Math.abs(v))<u*(Math.abs(a)*(Math.abs(n.get(R-1,R-1))+Math.abs(w)+Math.abs(n.get(R+1,R+1))))));)R--;for(c=R+2;c<=s;c++)n.set(c,c-2,0),c>R+2&&n.set(c,c-3,0);for(M=R;M<=s-1&&(C=M!==s-1,M!==R&&(a=n.get(M,M-1),g=n.get(M+1,M-1),v=C?n.get(M+2,M-1):0,k=Math.abs(a)+Math.abs(g)+Math.abs(v),k!==0&&(a=a/k,g=g/k,v=v/k)),k!==0);M++)if(m=Math.sqrt(a*a+g*g+v*v),a<0&&(m=-m),m!==0){for(M!==R?n.set(M,M-1,-m*k):_!==R&&n.set(M,M-1,-n.get(M,M-1)),a=a+m,k=a/m,D=g/m,w=v/m,g=g/a,v=v/a,d=M;d<o;d++)a=n.get(M,d)+g*n.get(M+1,d),C&&(a=a+v*n.get(M+2,d),n.set(M+2,d,n.get(M+2,d)-a*w)),n.set(M,d,n.get(M,d)-a*k),n.set(M+1,d,n.get(M+1,d)-a*D);for(c=0;c<=Math.min(s,M+3);c++)a=k*n.get(c,M)+D*n.get(c,M+1),C&&(a=a+w*n.get(c,M+2),n.set(c,M+2,n.get(c,M+2)-a*v)),n.set(c,M,n.get(c,M)-a),n.set(c,M+1,n.get(c,M+1)-a*g);for(c=i;c<=l;c++)a=k*t.get(c,M)+D*t.get(c,M+1),C&&(a=a+w*t.get(c,M+2),t.set(c,M+2,t.get(c,M+2)-a*v)),t.set(c,M,t.get(c,M)-a),t.set(c,M+1,t.get(c,M+1)-a*g)}}}if(f!==0){for(s=o-1;s>=0;s--)if(a=e[s],g=r[s],g===0)for(_=s,n.set(s,s,1),c=s-1;c>=0;c--){for(N=n.get(c,c)-a,v=0,d=_;d<=s;d++)v=v+n.get(c,d)*n.get(d,s);if(r[c]<0)w=N,m=v;else if(_=c,r[c]===0?n.set(c,s,N!==0?-v/N:-v/(u*f)):(k=n.get(c,c+1),D=n.get(c+1,c),g=(e[c]-a)*(e[c]-a)+r[c]*r[c],T=(k*m-w*v)/g,n.set(c,s,T),n.set(c+1,s,Math.abs(k)>Math.abs(w)?(-v-N*T)/k:(-m-D*T)/w)),T=Math.abs(n.get(c,s)),u*T*T>1)for(d=c;d<=s;d++)n.set(d,s,n.get(d,s)/T)}else if(g<0)for(_=s-1,Math.abs(n.get(s,s-1))>Math.abs(n.get(s-1,s))?(n.set(s-1,s-1,g/n.get(s,s-1)),n.set(s-1,s,-(n.get(s,s)-a)/n.get(s,s-1))):(z=It(0,-n.get(s-1,s),n.get(s-1,s-1)-a,g),n.set(s-1,s-1,z[0]),n.set(s-1,s,z[1])),n.set(s,s-1,0),n.set(s,s,1),c=s-2;c>=0;c--){for(p=0,S=0,d=_;d<=s;d++)p=p+n.get(c,d)*n.get(d,s-1),S=S+n.get(c,d)*n.get(d,s);if(N=n.get(c,c)-a,r[c]<0)w=N,v=p,m=S;else if(_=c,r[c]===0?(z=It(-p,-S,N,g),n.set(c,s-1,z[0]),n.set(c,s,z[1])):(k=n.get(c,c+1),D=n.get(c+1,c),E=(e[c]-a)*(e[c]-a)+r[c]*r[c]-g*g,b=(e[c]-a)*2*g,E===0&&b===0&&(E=u*f*(Math.abs(N)+Math.abs(g)+Math.abs(k)+Math.abs(D)+Math.abs(w))),z=It(k*v-w*p+g*S,k*m-w*S-g*p,E,b),n.set(c,s-1,z[0]),n.set(c,s,z[1]),Math.abs(k)>Math.abs(w)+Math.abs(g)?(n.set(c+1,s-1,(-p-N*n.get(c,s-1)+g*n.get(c,s))/k),n.set(c+1,s,(-S-N*n.get(c,s)-g*n.get(c,s-1))/k)):(z=It(-v-D*n.get(c,s-1),-m-D*n.get(c,s),w,g),n.set(c+1,s-1,z[0]),n.set(c+1,s,z[1]))),T=Math.max(Math.abs(n.get(c,s-1)),Math.abs(n.get(c,s))),u*T*T>1)for(d=c;d<=s;d++)n.set(d,s-1,n.get(d,s-1)/T),n.set(d,s,n.get(d,s)/T)}for(c=0;c<o;c++)if(c<i||c>l)for(d=c;d<o;d++)t.set(c,d,n.get(c,d));for(d=o-1;d>=i;d--)for(c=i;c<=l;c++){for(w=0,M=i;M<=Math.min(d,l);M++)w=w+t.get(c,M)*n.get(M,d);t.set(c,d,w)}}}function It(o,r,e,t){let n,s;return Math.abs(e)>Math.abs(t)?(n=t/e,s=e+n*t,[(o+n*r)/s,(r-n*o)/s]):(n=e/t,s=t+n*e,[(n*o+r)/s,(n*r-o)/s])}class Fe{constructor(r){if(r=rt.checkMatrix(r),!r.isSymmetric())throw new Error("Matrix is not symmetric");let e=r,t=e.rows,n=new j(t,t),s=!0,i,l,u;for(l=0;l<t;l++){let h=0;for(u=0;u<l;u++){let f=0;for(i=0;i<u;i++)f+=n.get(u,i)*n.get(l,i);f=(e.get(l,u)-f)/n.get(u,u),n.set(l,u,f),h=h+f*f}for(h=e.get(l,l)-h,s&&(s=h>0),n.set(l,l,Math.sqrt(Math.max(h,0))),u=l+1;u<t;u++)n.set(l,u,0)}this.L=n,this.positiveDefinite=s}isPositiveDefinite(){return this.positiveDefinite}solve(r){r=rt.checkMatrix(r);let e=this.L,t=e.rows;if(r.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let n=r.columns,s=r.clone(),i,l,u;for(u=0;u<t;u++)for(l=0;l<n;l++){for(i=0;i<u;i++)s.set(u,l,s.get(u,l)-s.get(i,l)*e.get(u,i));s.set(u,l,s.get(u,l)/e.get(u,u))}for(u=t-1;u>=0;u--)for(l=0;l<n;l++){for(i=u+1;i<t;i++)s.set(u,l,s.get(u,l)-s.get(i,l)*e.get(i,u));s.set(u,l,s.get(u,l)/e.get(u,u))}return s}get lowerTriangularMatrix(){return this.L}}class Oe{constructor(r,e={}){r=rt.checkMatrix(r);let{Y:t}=e;const{scaleScores:n=!1,maxIterations:s=1e3,terminationCriteria:i=1e-10}=e;let l;if(t){if(H.isAnyArray(t)&&typeof t[0]=="number"?t=j.columnVector(t):t=rt.checkMatrix(t),t.rows!==r.rows)throw new Error("Y should have the same number of rows as X");l=t.getColumnVector(0)}else l=r.getColumnVector(0);let u=1,h,f,a,g;for(let v=0;v<s&&u>i;v++)a=r.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),a=a.div(a.norm()),h=r.mmul(a).div(a.transpose().mmul(a).get(0,0)),v>0&&(u=h.clone().sub(g).pow(2).sum()),g=h.clone(),t?(f=t.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),f=f.div(f.norm()),l=t.mmul(f).div(f.transpose().mmul(f).get(0,0))):l=h;if(t){let v=r.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0));v=v.div(v.norm());let m=r.clone().sub(h.clone().mmul(v.transpose())),w=l.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),y=t.clone().sub(h.clone().mulS(w.get(0,0)).mmul(f.transpose()));this.t=h,this.p=v.transpose(),this.w=a.transpose(),this.q=f,this.u=l,this.s=h.transpose().mmul(h),this.xResidual=m,this.yResidual=y,this.betas=w}else this.w=a.transpose(),this.s=h.transpose().mmul(h).sqrt(),n?this.t=h.clone().div(this.s.get(0,0)):this.t=h,this.xResidual=r.sub(h.mmul(a.transpose()))}}F.AbstractMatrix=P;F.CHO=Fe;F.CholeskyDecomposition=Fe;F.DistanceMatrix=qt;var Hn=F.EVD=Te;F.EigenvalueDecomposition=Te;F.LU=xt;F.LuDecomposition=xt;var $e=F.Matrix=j;F.MatrixColumnSelectionView=On;F.MatrixColumnView=Fn;F.MatrixFlipColumnView=$n;F.MatrixFlipRowView=Dn;F.MatrixRowSelectionView=Cn;F.MatrixRowView=Vn;F.MatrixSelectionView=Ft;F.MatrixSubView=Ln;var ts=F.MatrixTransposeView=qn,es=F.NIPALS=Oe;F.Nipals=Oe;F.QR=se;F.QrDecomposition=se;var rs=F.SVD=St;F.SingularValueDecomposition=St;F.SymmetricMatrix=gt;F.WrapperMatrix1D=ze;F.WrapperMatrix2D=rt;F.correlation=Qn;F.covariance=Kn;var fe=F.default=j;F.determinant=Ot;var ns=F.inverse=Un;F.linearDependencies=Yn;F.pseudoInverse=Gn;F.solve=Pe;F.wrap=xn;const ss=Hn,it=$e,os=ts,is=es,ls=rs;fe.Matrix&&fe.Matrix;const hs=ns;function us(o,r,e,t,n){const s=e.length,i=o.x.length;let l=new Array(s);for(let u=0;u<s;u++){l[u]=new Array(i);let h=e.slice();h[u]+=t;let f=n(h);for(let a=0;a<i;a++)l[u][a]=r[a]-f(o.x[a])}return new it(l)}function as(o,r){const e=o.x.length;let t=new Array(e);for(let n=0;n<e;n++)t[n]=[o.y[n]-r[n]];return new it(t)}function fs(o,r,e,t,n){let s=e*t*t,i=it.eye(r.length,r.length,s);const l=n(r);let u=new Float64Array(o.x.length);for(let g=0;g<o.x.length;g++)u[g]=l(o.x[g]);let h=us(o,u,r,t,n),f=as(o,u),a=hs(i.add(h.mmul(h.transpose())));return r=new it([r]),r=r.sub(a.mmul(h).mmul(f).mul(t).transpose()),r.to1DArray()}function cs(o,r,e={}){let{maxIterations:t=100,gradientDifference:n=.1,damping:s=0,errorTolerance:i=.01,minValues:l,maxValues:u,initialValues:h}=e;if(s<=0)throw new Error("The damping option must be a positive number");if(!o.x||!o.y)throw new Error("The data parameter must have x and y elements");if(!Yt(o.x)||o.x.length<2||!Yt(o.y)||o.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(o.x.length!==o.y.length)throw new Error("The data parameter elements must have the same size");let f=h||new Array(r.length).fill(1),a=f.length;if(u=u||new Array(a).fill(Number.MAX_SAFE_INTEGER),l=l||new Array(a).fill(Number.MIN_SAFE_INTEGER),u.length!==l.length)throw new Error("minValues and maxValues must be the same size");if(!Yt(f))throw new Error("initialValues must be an array");let g=le(o,f,r),v=g<=i,m;for(m=0;m<t&&!v;m++){f=fs(o,f,s,n,r);for(let w=0;w<a;w++)f[w]=Math.min(Math.max(l[w],f[w]),u[w]);if(g=le(o,f,r),isNaN(g))break;v=g<=i}return{parameterValues:f,parameterError:g,iterations:m}}const gs=Object.freeze(Object.defineProperty({__proto__:null,default:cs},Symbol.toStringTag,{value:"Module"})),ms=te(gs);var ps=I&&I.__createBinding||(Object.create?function(o,r,e,t){t===void 0&&(t=e),Object.defineProperty(o,t,{enumerable:!0,get:function(){return r[e]}})}:function(o,r,e,t){t===void 0&&(t=e),o[t]=r[e]}),ws=I&&I.__setModuleDefault||(Object.create?function(o,r){Object.defineProperty(o,"default",{enumerable:!0,value:r})}:function(o,r){o.default=r}),Rt=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)e!=="default"&&Object.hasOwnProperty.call(o,e)&&ps(r,o,e);return ws(r,o),r},ce=I&&I.__awaiter||function(o,r,e,t){function n(s){return s instanceof e?s:new e(function(i){i(s)})}return new(e||(e=Promise))(function(s,i){function l(f){try{h(t.next(f))}catch(a){i(a)}}function u(f){try{h(t.throw(f))}catch(a){i(a)}}function h(f){f.done?s(f.value):n(f.value).then(l,u)}h((t=t.apply(o,r||[])).next())})},ge=I&&I.__generator||function(o,r){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},t,n,s,i;return i={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function l(h){return function(f){return u([h,f])}}function u(h){if(t)throw new TypeError("Generator is already executing.");for(;e;)try{if(t=1,n&&(s=h[0]&2?n.return:h[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,h[1])).done)return s;switch(n=0,s&&(h=[h[0]&2,s.value]),h[0]){case 0:case 1:s=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,n=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!s||h[1]>s[0]&&h[1]<s[3])){e.label=h[1];break}if(h[0]===6&&e.label<s[1]){e.label=s[1],s=h;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(h);break}s[2]&&e.ops.pop(),e.trys.pop();continue}h=r.call(o,e)}catch(f){h=[6,f],n=0}finally{t=s=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},Ht=I&&I.__read||function(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var t=e.call(o),n,s=[],i;try{for(;(r===void 0||r-- >0)&&!(n=t.next()).done;)s.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(i)throw i.error}}return s},me=I&&I.__spread||function(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(Ht(arguments[r]));return o},vs=I&&I.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Z,"__esModule",{value:!0});Z.initTransform=Z.resetLocalConnectivity=Z.fastIntersection=Z.findABParams=Z.cosine=Z.euclidean=Z.UMAP=void 0;var ds=Rt(K),x=Rt(q),zt=Rt(ut),pe=Rt(lt),B=Rt($),ys=vs(ms),we=1e-5,Pt=.001,Ss=function(){function o(r){var e=this;r===void 0&&(r={}),this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=De,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new Ms;var t=function(n){r[n]!==void 0&&(e[n]=r[n])};t("distanceFn"),t("learningRate"),t("localConnectivity"),t("minDist"),t("nComponents"),t("nEpochs"),t("nNeighbors"),t("negativeSampleRate"),t("random"),t("repulsionStrength"),t("setOpMixRatio"),t("spread"),t("transformQueueSize")}return o.prototype.fit=function(r){return this.initializeFit(r),this.optimizeLayout(),this.embedding},o.prototype.fitAsync=function(r,e){return e===void 0&&(e=function(){return!0}),ce(this,void 0,void 0,function(){return ge(this,function(t){switch(t.label){case 0:return this.initializeFit(r),[4,this.optimizeLayoutAsync(e)];case 1:return t.sent(),[2,this.embedding]}})})},o.prototype.setSupervisedProjection=function(r,e){e===void 0&&(e={}),this.Y=r,this.targetMetric=e.targetMetric||this.targetMetric,this.targetWeight=e.targetWeight||this.targetWeight,this.targetNNeighbors=e.targetNNeighbors||this.targetNNeighbors},o.prototype.setPrecomputedKNN=function(r,e){this.knnIndices=r,this.knnDistances=e},o.prototype.initializeFit=function(r){if(r.length<=this.nNeighbors)throw new Error("Not enough data points ("+r.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===r&&this.isInitialized)return this.getNEpochs();if(this.X=r,!this.knnIndices&&!this.knnDistances){var e=this.nearestNeighbors(r);this.knnIndices=e.knnIndices,this.knnDistances=e.knnDistances}this.graph=this.fuzzySimplicialSet(r,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(r),this.processGraphForSupervisedProjection();var t=this.initializeSimplicialSetEmbedding(),n=t.head,s=t.tail,i=t.epochsPerSample;return this.optimizationState.head=n,this.optimizationState.tail=s,this.optimizationState.epochsPerSample=i,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},o.prototype.makeSearchFns=function(){var r=zt.makeInitializations(this.distanceFn),e=r.initFromTree,t=r.initFromRandom;this.initFromTree=e,this.initFromRandom=t,this.search=zt.makeInitializedNNSearch(this.distanceFn)},o.prototype.makeSearchGraph=function(r){for(var e=this.knnIndices,t=this.knnDistances,n=[r.length,r.length],s=new x.SparseMatrix([],[],[],n),i=0;i<e.length;i++)for(var l=e[i],u=t[i],h=0;h<l.length;h++){var f=l[h],a=u[h];a>0&&s.set(i,f,a)}var g=x.transpose(s);return x.maximum(s,g)},o.prototype.transform=function(r){var e=this,t=this.X;if(t===void 0||t.length===0)throw new Error("No data has been fit.");var n=Math.floor(this.nNeighbors*this.transformQueueSize);n=Math.min(t.length,n);var s=zt.initializeSearch(this.rpForest,t,r,n,this.initFromRandom,this.initFromTree,this.random),i=this.search(t,this.searchGraph,s,r),l=ds.deheapSort(i),u=l.indices,h=l.weights;u=u.map(function(z){return z.slice(0,e.nNeighbors)}),h=h.map(function(z){return z.slice(0,e.nNeighbors)});var f=Math.max(0,this.localConnectivity-1),a=this.smoothKNNDistance(h,this.nNeighbors,f),g=a.sigmas,v=a.rhos,m=this.computeMembershipStrengths(u,h,g,v),w=m.rows,y=m.cols,c=m.vals,d=[r.length,t.length],M=new x.SparseMatrix(w,y,c,d),_=x.normalize(M,"l1"),R=x.getCSR(_),T=r.length,N=B.reshape2d(R.indices,T,this.nNeighbors),k=B.reshape2d(R.values,T,this.nNeighbors),D=qe(N,k,this.embedding),p=this.nEpochs?this.nEpochs/3:M.nRows<=1e4?100:30,S=M.getValues().reduce(function(z,V){return V>z?V:z},0);M=M.map(function(z){return z<S/p?0:z}),M=x.eliminateZeros(M);var E=this.makeEpochsPerSample(M.getValues(),p),b=M.getRows(),C=M.getCols();return this.assignOptimizationStateParameters({headEmbedding:D,tailEmbedding:this.embedding,head:b,tail:C,currentEpoch:0,nEpochs:p,nVertices:M.getDims()[1],epochsPerSample:E}),this.prepareForOptimizationLoop(),this.optimizeLayout()},o.prototype.processGraphForSupervisedProjection=function(){var r=this,e=r.Y,t=r.X;if(e){if(e.length!==t.length)throw new Error("Length of X and y must be equal");if(this.targetMetric==="categorical"){var n=this.targetWeight<1,s=n?2.5*(1/(1-this.targetWeight)):1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,e,s)}}},o.prototype.step=function(){var r=this.optimizationState.currentEpoch;return r<this.getNEpochs()&&this.optimizeLayoutStep(r),this.optimizationState.currentEpoch},o.prototype.getEmbedding=function(){return this.embedding},o.prototype.nearestNeighbors=function(r){var e=this,t=e.distanceFn,n=e.nNeighbors,s=function(m){return Math.log(m)/Math.log(2)},i=zt.makeNNDescent(t,this.random),l=function(m){return m===.5?0:Math.round(m)},u=5+Math.floor(l(Math.pow(r.length,.5)/20)),h=Math.max(5,Math.floor(Math.round(s(r.length))));this.rpForest=pe.makeForest(r,n,u,this.random);var f=pe.makeLeafArray(this.rpForest),a=i(r,f,n,h),g=a.indices,v=a.weights;return{knnIndices:g,knnDistances:v}},o.prototype.fuzzySimplicialSet=function(r,e,t){t===void 0&&(t=1);var n=this,s=n.knnIndices,i=s===void 0?[]:s,l=n.knnDistances,u=l===void 0?[]:l,h=n.localConnectivity,f=this.smoothKNNDistance(u,e,h),a=f.sigmas,g=f.rhos,v=this.computeMembershipStrengths(i,u,a,g),m=v.rows,w=v.cols,y=v.vals,c=[r.length,r.length],d=new x.SparseMatrix(m,w,y,c),M=x.transpose(d),_=x.pairwiseMultiply(d,M),R=x.subtract(x.add(d,M),_),T=x.multiplyScalar(R,t),N=x.multiplyScalar(_,1-t),k=x.add(T,N);return k},o.prototype.categoricalSimplicialSetIntersection=function(r,e,t,n){n===void 0&&(n=1);var s=Ce(r,e,n,t);return s=x.eliminateZeros(s),Le(s)},o.prototype.smoothKNNDistance=function(r,e,t,n,s){t===void 0&&(t=1),n===void 0&&(n=64),s===void 0&&(s=1);for(var i=Math.log(e)/Math.log(2)*s,l=B.zeros(r.length),u=B.zeros(r.length),h=0;h<r.length;h++){var f=0,a=1/0,g=1,v=r[h],m=v.filter(function(N){return N>0});if(m.length>=t){var w=Math.floor(t),y=t-w;w>0?(l[h]=m[w-1],y>we&&(l[h]+=y*(m[w]-m[w-1]))):l[h]=y*m[0]}else m.length>0&&(l[h]=B.max(m));for(var c=0;c<n;c++){for(var d=0,M=1;M<r[h].length;M++){var _=r[h][M]-l[h];_>0?d+=Math.exp(-(_/g)):d+=1}if(Math.abs(d-i)<we)break;d>i?(a=g,g=(f+a)/2):(f=g,a===1/0?g*=2:g=(f+a)/2)}if(u[h]=g,l[h]>0){var R=B.mean(v);u[h]<Pt*R&&(u[h]=Pt*R)}else{var T=B.mean(r.map(B.mean));u[h]<Pt*T&&(u[h]=Pt*T)}}return{sigmas:u,rhos:l}},o.prototype.computeMembershipStrengths=function(r,e,t,n){for(var s=r.length,i=r[0].length,l=B.zeros(s*i),u=B.zeros(s*i),h=B.zeros(s*i),f=0;f<s;f++)for(var a=0;a<i;a++){var g=0;r[f][a]!==-1&&(r[f][a]===f?g=0:e[f][a]-n[f]<=0?g=1:g=Math.exp(-((e[f][a]-n[f])/t[f])),l[f*i+a]=f,u[f*i+a]=r[f][a],h[f*i+a]=g)}return{rows:l,cols:u,vals:h}},o.prototype.initializeSimplicialSetEmbedding=function(){for(var r=this,e=this.getNEpochs(),t=this.nComponents,n=this.graph.getValues(),s=0,i=0;i<n.length;i++){var l=n[i];s<n[i]&&(s=l)}var u=this.graph.map(function(w){return w<s/e?0:w});this.embedding=B.zeros(u.nRows).map(function(){return B.zeros(t).map(function(){return B.tauRand(r.random)*20+-10})});for(var h=[],f=[],a=[],g=u.getAll(),i=0;i<g.length;i++){var v=g[i];v.value&&(h.push(v.value),a.push(v.row),f.push(v.col))}var m=this.makeEpochsPerSample(h,e);return{head:f,tail:a,epochsPerSample:m}},o.prototype.makeEpochsPerSample=function(r,e){var t=B.filled(r.length,-1),n=B.max(r),s=r.map(function(i){return i/n*e});return s.forEach(function(i,l){i>0&&(t[l]=e/s[l])}),t},o.prototype.assignOptimizationStateParameters=function(r){Object.assign(this.optimizationState,r)},o.prototype.prepareForOptimizationLoop=function(){var r=this,e=r.repulsionStrength,t=r.learningRate,n=r.negativeSampleRate,s=this.optimizationState,i=s.epochsPerSample,l=s.headEmbedding,u=s.tailEmbedding,h=l[0].length,f=l.length===u.length,a=i.map(function(m){return m/n}),g=me(a),v=me(i);this.assignOptimizationStateParameters({epochOfNextSample:v,epochOfNextNegativeSample:g,epochsPerNegativeSample:a,moveOther:f,initialAlpha:t,alpha:t,gamma:e,dim:h})},o.prototype.initializeOptimization=function(){var r=this.embedding,e=this.embedding,t=this.optimizationState,n=t.head,s=t.tail,i=t.epochsPerSample,l=this.getNEpochs(),u=this.graph.nCols,h=Ve(this.spread,this.minDist),f=h.a,a=h.b;this.assignOptimizationStateParameters({headEmbedding:r,tailEmbedding:e,head:n,tail:s,epochsPerSample:i,a:f,b:a,nEpochs:l,nVertices:u})},o.prototype.optimizeLayoutStep=function(r){for(var e=this.optimizationState,t=e.head,n=e.tail,s=e.headEmbedding,i=e.tailEmbedding,l=e.epochsPerSample,u=e.epochOfNextSample,h=e.epochOfNextNegativeSample,f=e.epochsPerNegativeSample,a=e.moveOther,g=e.initialAlpha,v=e.alpha,m=e.gamma,w=e.a,y=e.b,c=e.dim,d=e.nEpochs,M=e.nVertices,_=4,R=0;R<l.length;R++)if(!(u[R]>r)){var T=t[R],N=n[R],k=s[T],D=i[N],p=de(k,D),S=0;p>0&&(S=-2*w*y*Math.pow(p,y-1),S/=w*Math.pow(p,y)+1);for(var E=0;E<c;E++){var b=ve(S*(k[E]-D[E]),_);k[E]+=b*v,a&&(D[E]+=-b*v)}u[R]+=l[R];for(var C=Math.floor((r-h[R])/f[R]),z=0;z<C;z++){var V=B.tauRandInt(M,this.random),L=i[V],U=de(k,L),Q=0;if(U>0)Q=2*m*y,Q/=(.001+U)*(w*Math.pow(U,y)+1);else if(T===V)continue;for(var E=0;E<c;E++){var b=4;Q>0&&(b=ve(Q*(k[E]-L[E]),_)),k[E]+=b*v}}h[R]+=C*f[R]}return e.alpha=g*(1-r/d),e.currentEpoch+=1,s},o.prototype.optimizeLayoutAsync=function(r){var e=this;return r===void 0&&(r=function(){return!0}),new Promise(function(t,n){var s=function(){return ce(e,void 0,void 0,function(){var i,l,u,h,f,a;return ge(this,function(g){try{if(i=this.optimizationState,l=i.nEpochs,u=i.currentEpoch,this.embedding=this.optimizeLayoutStep(u),h=this.optimizationState.currentEpoch,f=r(h)===!1,a=h===l,!f&&!a)setTimeout(function(){return s()},0);else return[2,t(a)]}catch(v){n(v)}return[2]})})};setTimeout(function(){return s()},0)})},o.prototype.optimizeLayout=function(r){r===void 0&&(r=function(){return!0});for(var e=!1,t=[];!e;){var n=this.optimizationState,s=n.nEpochs,i=n.currentEpoch;t=this.optimizeLayoutStep(i);var l=this.optimizationState.currentEpoch,u=r(l)===!1;e=l===s||u}return t},o.prototype.getNEpochs=function(){var r=this.graph;if(this.nEpochs>0)return this.nEpochs;var e=r.nRows;return e<=2500?500:e<=5e3?400:e<=7500?300:200},o}();Z.UMAP=Ss;function De(o,r){for(var e=0,t=0;t<o.length;t++)e+=Math.pow(o[t]-r[t],2);return Math.sqrt(e)}Z.euclidean=De;function bs(o,r){for(var e=0,t=0,n=0,s=0;s<o.length;s++)e+=o[s]*r[s],t+=Math.pow(o[s],2),n+=Math.pow(r[s],2);return t===0&&n===0?0:t===0||n===0?1:1-e/Math.sqrt(t*n)}Z.cosine=bs;var Ms=function(){function o(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}return o}();function ve(o,r){return o>r?r:o<-r?-r:o}function de(o,r){for(var e=0,t=0;t<o.length;t++)e+=Math.pow(o[t]-r[t],2);return e}function Ve(o,r){var e=function(g){var v=Ht(g,2),m=v[0],w=v[1];return function(y){return 1/(1+m*Math.pow(y,2*w))}},t=B.linear(0,o*3,300).map(function(g){return g<r?1:g}),n=B.zeros(t.length).map(function(g,v){var m=t[v]>=r;return m?Math.exp(-(t[v]-r)/o):g}),s=[.5,.5],i={x:t,y:n},l={damping:1.5,initialValues:s,gradientDifference:.1,maxIterations:100,errorTolerance:.01},u=ys.default(i,e,l).parameterValues,h=Ht(u,2),f=h[0],a=h[1];return{a:f,b:a}}Z.findABParams=Ve;function Ce(o,r,e,t){return e===void 0&&(e=1),t===void 0&&(t=5),o.map(function(n,s,i){return r[s]===-1||r[i]===-1?n*Math.exp(-e):r[s]!==r[i]?n*Math.exp(-t):n})}Z.fastIntersection=Ce;function Le(o){o=x.normalize(o,"max");var r=x.transpose(o),e=x.pairwiseMultiply(r,o);return o=x.add(o,x.subtract(r,e)),x.eliminateZeros(o)}Z.resetLocalConnectivity=Le;function qe(o,r,e){for(var t=B.zeros(o.length).map(function(u){return B.zeros(e[0].length)}),n=0;n<o.length;n++)for(var s=0;s<o[0].length;s++)for(var i=0;i<e[0].length;i++){var l=o[n][s];t[n][i]+=r[n][s]*e[l][i]}return t}Z.initTransform=qe;(function(o){Object.defineProperty(o,"__esModule",{value:!0});var r=Z;Object.defineProperty(o,"UMAP",{enumerable:!0,get:function(){return r.UMAP}})})(He);class xe{constructor(r,e={},t){if(this.U=null,this.S=null,t){this.center=t.center,this.scale=t.scale,this.means=t.means,this.stdevs=t.stdevs,this.U=it.checkMatrix(t.U),this.S=t.S,this.R=t.R,this.excludedFeatures=t.excludedFeatures||[];return}let n;Array.isArray(r)?n=new it(r):n=new it(r);const{isCovarianceMatrix:s=!1,method:i="SVD",nCompNIPALS:l=2,center:u=!0,scale:h=!1,ignoreZeroVariance:f=!1}=e;if(this.center=u,this.scale=h,this.means=null,this.stdevs=null,this.excludedFeatures=[],s){this._computeFromCovarianceMatrix(n);return}switch(this._adjust(n,f),i){case"covarianceMatrix":{const a=new os(n).mmul(n).div(n.rows-1);this._computeFromCovarianceMatrix(a);break}case"NIPALS":{this._computeWithNIPALS(n,l);break}case"SVD":{const a=new ls(n,{computeLeftSingularVectors:!1,computeRightSingularVectors:!0,autoTranspose:!0});this.U=a.rightSingularVectors;const g=a.diagonal,v=[];for(const m of g)v.push(m*m/(n.rows-1));this.S=v;break}default:throw new Error(`unknown method: ${i}`)}}static load(r){if(typeof r.name!="string")throw new TypeError("model must have a name property");if(r.name!=="PCA")throw new RangeError(`invalid model: ${r.name}`);return new xe(void 0,void 0,r)}predict(r,e={}){const{nComponents:t=this.U.columns}=e;let n;if(Array.isArray(r)?n=new it(r):n=new it(r),this.center&&(n.subRowVector(this.means),this.scale)){for(let i of this.excludedFeatures)n.removeColumn(i);n.divRowVector(this.stdevs)}let s=n.mmul(this.U);return s.subMatrix(0,s.rows-1,0,t-1)}invert(r){r=it.checkMatrix(r);let e=r.mmul(this.U.transpose());return this.center&&(this.scale&&e.mulRowVector(this.stdevs),e.addRowVector(this.means)),e}getExplainedVariance(){let r=0;if(this.S)for(const e of this.S)r+=e;return this.S?this.S.map(e=>e/r):[]}getCumulativeVariance(){let r=this.getExplainedVariance();for(let e=1;e<r.length;e++)r[e]+=r[e-1];return r}getEigenvectors(){return this.U}getEigenvalues(){return this.S}getStandardDeviations(){return this.S.map(r=>Math.sqrt(r))}getLoadings(){return this.U.transpose()}toJSON(){return{name:"PCA",center:this.center,scale:this.scale,means:this.means,stdevs:this.stdevs,U:this.U,S:this.S,excludedFeatures:this.excludedFeatures}}_adjust(r,e){if(this.center){const t=r.mean("column"),n=this.scale?r.standardDeviation("column",{mean:t}):null;if(this.means=t,r.subRowVector(t),this.scale){for(let s=0;s<n.length;s++)if(n[s]===0)if(e)r.removeColumn(s),n.splice(s,1),this.excludedFeatures.push(s),s--;else throw new RangeError(`Cannot scale the dataset (standard deviation is zero at index ${s}`);this.stdevs=n,r.divRowVector(n)}}}_computeFromCovarianceMatrix(r){const e=new ss(r,{assumeSymmetric:!0});this.U=e.eigenvectorMatrix,this.U.flipRows(),this.S=e.realEigenvalues,this.S.reverse()}_computeWithNIPALS(r,e){this.U=new it(e,r.columns),this.S=[];let t=r;for(let n=0;n<e;n++){let s=new is(t);this.U.setRow(n,s.w.transpose()),this.S.push(Math.pow(s.s.get(0,0),2)),t=s.xResidual}this.U=this.U.transpose()}}export{xe as P,He as d};
